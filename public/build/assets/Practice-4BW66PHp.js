import{K as me,r as n,j as e,L as Y}from"./app-BXkh_5rv.js";import{b as F,A as D}from"./app-layout-R1sBcfYc.js";import{S as Q}from"./sweetalert2.esm.all-acGi8jXx.js";import{A as ue}from"./AnimatedBackground-CcoeZFf4.js";import{R as he}from"./refresh-cw-DB0teuv7.js";import{B as ge,X as fe}from"./x-BzajcVGq.js";import{C as H}from"./users-CI_zANhe.js";import{L as W}from"./lightbulb-B22fJUFS.js";import{F as pe}from"./filter-CdGKyUmN.js";import{S as be}from"./search-DcLotlZ8.js";import{C as ye}from"./chart-column-Bm86jhXS.js";import{E as je}from"./eye-off-BbR7Rrav.js";import{E as we}from"./eye-CTmog7uI.js";import{C as Ne}from"./circle-check-big-9J22n0lS.js";import{A as ve}from"./arrow-left-DHr4gbPR.js";import{A as Se}from"./arrow-right-sMukzarN.js";import"./utils-jAU0Cazi.js";import"./createLucideIcon-CsMIB6GZ.js";const G=[{title:"Home",href:"/dashboard"},{title:"Practice",href:"#"},{title:"Review Mode",href:"/play/practice"}];function Ke(){var J,K;const{auth:E}=me().props;E==null||E.user;const[j,$]=n.useState([]),[v,V]=n.useState([]),[S,w]=n.useState(0),[P,O]=n.useState(null),[h,z]=n.useState(!1),[C,R]=n.useState(!1),[k,U]=n.useState("python"),[g,Z]=n.useState("all"),[L,ee]=n.useState(""),[se,B]=n.useState(!0),[te,ae]=n.useState([]),[x,_]=n.useState(new Set),[o,re]=n.useState(0),N=n.useRef(null),y=n.useRef(null),M=((J=document.querySelector('meta[name="csrf-token"]'))==null?void 0:J.content)||((K=window.Laravel)==null?void 0:K.csrfToken)||"",[ne,Ce]=n.useState(!0);n.useRef(null);const p=s=>{if(ne)try{F.play(s)}catch{}};n.useEffect(()=>{I()},[k]),n.useEffect(()=>{le()},[j,g,L,x]),n.useEffect(()=>{if(y.current&&o>0&&x.size>=o){const{id:s,set_index:a,language:t}=y.current;fetch("/practice/finish",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":M},body:JSON.stringify({question_set_id:s})}).catch(()=>{}).finally(async()=>{try{const r=await(await fetch(`/practice/sets?language=${t}`,{credentials:"same-origin"})).json(),u=(Array.isArray(r==null?void 0:r.sets)?r.sets:[]).find(i=>i.set_index>a);if(u){try{F.play("success")}catch{}await Q.fire({icon:"success",title:"ðŸŽ‰ Congratulations!",html:`<div class="text-left">
              <p>Youâ€™ve finished <b>Set #${a}</b> (${t}).</p>
              <p class="mt-2">The next set <b>#${u.set_index}</b> is available. Ready to continue?</p>
            </div>`,confirmButtonText:`Start Set #${u.set_index}`,showCancelButton:!0,cancelButtonText:"Later",customClass:{popup:"bg-gray-900 text-gray-100"}}),I()}else{try{F.play("success")}catch{}await Q.fire({icon:"success",title:"ðŸŽ‰ Great job!",html:`<div class="text-left">
              <p>Youâ€™ve finished <b>Set #${a}</b> (${t}).</p>
              <p class="mt-2">No next set is uploaded yet. <b>Stay tuned</b> for more questions!</p>
            </div>`,confirmButtonText:"Okay",customClass:{popup:"bg-gray-900 text-gray-100"}})}}catch{I()}})}},[x,o]);const I=async()=>{var a;const s=new AbortController;try{B(!0);const t=await fetch(`/practice/current?language=${k}`,{signal:s.signal,credentials:"same-origin"});if(!t.ok)throw new Error("Failed to fetch current set");const m=await t.json(),{set:r,progress:c}=m;y.current={id:r.id,filename:r.filename,total_questions:r.total_questions,set_index:r.set_index,language:r.language},re(r.total_questions||0),N.current=(c==null?void 0:c.last_question_id)??null;const u=await fetch(`/data/${r.filename}`,{signal:s.signal,credentials:"same-origin"});if(!u.ok)throw new Error(`Failed to load ${r.filename}`);const i=await u.json();$(i),ae([...new Set(i.map(f=>f.category))]);const d=new Set(i.map(f=>f.id));if(d.size!==i.length){const f=new Set,X=[];i.forEach(q=>{f.has(q.id)?X.push(q.id):f.add(q.id)}),console.warn("[Practice] Duplicate or missing IDs detected",{file:(a=y.current)==null?void 0:a.filename,totalRows:i.length,uniqueIds:d.size,duplicates:Array.from(new Set(X))})}const T=Array.isArray(c==null?void 0:c.taken_ids)?c.taken_ids:[];_(new Set(T)),A()}catch(t){(t==null?void 0:t.name)!=="AbortError"&&(console.error("Error loading questions:",t),$([]),Q.fire({icon:"error",title:"Loading Error",text:"Failed to load questions or set metadata. Make sure the routes and JSON files exist."}))}finally{B(!1)}return()=>s.abort()},le=()=>{const s=L.trim().toLowerCase();let a=j.filter(t=>!x.has(t.id));if(g!=="all"&&(a=a.filter(t=>t.category===g)),s&&(a=a.filter(t=>t.question.toLowerCase().includes(s)||t.category.toLowerCase().includes(s))),V(a),a.length===0){w(0);return}if(N.current!=null){const t=N.current;let m=null;const r={};j.forEach((i,d)=>r[i.id]=d);const c=r[t]??-1;for(let i=c+1;i<j.length;i++){const d=j[i],T=g==="all"||d.category===g,f=!s||d.question.toLowerCase().includes(s)||d.category.toLowerCase().includes(s);if(!x.has(d.id)&&T&&f){m=d.id;break}}m==null&&(m=a[0].id);const u=a.findIndex(i=>i.id===m);w(u>=0?u:0),N.current=null}else w(t=>Math.min(t,Math.max(0,a.length-1)))},A=()=>{O(null),z(!1),R(!1)},l=v[S],b=h&&P===(l==null?void 0:l.answer),ie=v.length===1||S===v.length-1,oe=async()=>{if(l&&y.current){_(s=>{const a=new Set(s);return a.add(l.id),a});try{await fetch("/practice/taken",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":M},body:JSON.stringify({question_set_id:y.current.id,question_id:l.id})}),N.current=l.id}catch(s){console.error("Failed to mark taken",s)}}A()},ce=()=>{S>0&&(w(s=>s-1),A())},de=()=>R(s=>!s),xe=s=>{h||!l||(p("click"),O(s),z(!0),R(!0),s===l.answer?p("success"):p("failure"))};return se?e.jsxs(D,{breadcrumbs:G,children:[e.jsx(Y,{title:"Practice Review"}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(he,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-blue-400"}),e.jsx("div",{className:"text-gray-300",children:"Loading questions..."})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx(ue,{}),e.jsxs(D,{breadcrumbs:G,children:[e.jsx(Y,{title:"Practice Review"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4 relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ge,{className:"h-8 w-8 text-blue-400"}),e.jsx(H,{className:"h-6 w-6 text-purple-400"}),e.jsx(W,{className:"h-8 w-8 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"PRACTICE REVIEWyw"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Review programming questions and learn from explanations"})]})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"lg:w-1/3 flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(pe,{className:"h-5 w-5 text-purple-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Question Filters"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Language"}),e.jsxs("select",{value:k,onChange:s=>U(s.target.value),className:"w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200",children:[e.jsx("option",{value:"python",children:"Python"}),e.jsx("option",{value:"java",children:"Java"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Category"}),e.jsxs("select",{value:g,onChange:s=>Z(s.target.value),className:"w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200",children:[e.jsx("option",{value:"all",children:"All Categories"}),te.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search...",value:L,onChange:s=>ee(s.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200 placeholder-gray-400"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ye,{className:"h-5 w-5 text-green-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Session Stats"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Total Questions:"}),e.jsx("span",{className:"text-blue-300 font-medium",children:o})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Current Progress:"}),e.jsxs("span",{className:"text-purple-300 font-medium",children:[x.size,"/",o]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Language:"}),e.jsx("span",{className:"text-green-300 font-medium capitalize",children:k})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Category:"}),e.jsx("span",{className:"text-yellow-300 font-medium",children:g==="all"?"All":g})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[e.jsx("span",{children:"Completion"}),e.jsxs("span",{children:[o>0?Math.round(x.size/o*100):0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${o>0?Math.round(x.size/o*100):0}%`}})})]})]})]}),e.jsx("div",{className:"lg:w-2/3",children:v.length===0?e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-12 text-center",children:[e.jsx(H,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl text-gray-300 mb-2",children:"No Questions Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"You may have completed all questions for this set/filter."}),e.jsx("button",{onClick:()=>{_(new Set),w(0),A()},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:"Revisit Questions in This Set"})]}):l&&e.jsxs("div",{className:"bg-gray-900/60 rounded-xl shadow-lg overflow-hidden border border-gray-700",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 flex items-center justify-between",children:[e.jsx("div",{className:"bg-white/20 px-3 py-1 rounded-full text-white text-sm font-medium shadow-md",children:l.category}),e.jsxs("button",{onClick:()=>{de(),p("hover")},className:"flex items-center space-x-2 px-4 py-2 bg-white/10 hover:bg-white/20 text-white font-medium rounded-lg shadow transition",children:[C?e.jsx(je,{className:"h-4 w-4"}):e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:C?"Hide Answer":"Show Answer"})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsx("div",{className:"mb-6 p-4 bg-gray-800/40 border border-gray-700 rounded-lg",children:e.jsx("p",{className:"text-xl text-white font-semibold leading-relaxed whitespace-pre-line",children:l.question.split(/(`[^`]+`)/g).map((s,a)=>s.startsWith("`")?e.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded text-purple-300 font-mono text-base",children:s.replace(/`/g,"")},a):s)})}),h&&e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold ${b?"bg-green-900/40 text-green-200":"bg-rose-900/40 text-rose-200"}`,children:[b?e.jsx(Ne,{className:"h-4 w-4"}):e.jsx(fe,{className:"h-4 w-4"}),b?"Correct":"Incorrect"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-6",children:l.choices.map((s,a)=>{const t=s===l.answer,m=s===P;let r="p-4 rounded-lg border cursor-pointer transition-all ";return C?t?r+="bg-green-900/50 border-green-400 text-green-100":h&&m&&!t?r+="bg-rose-900/50 border-rose-400 text-rose-100":r+="bg-gray-900/20 border-gray-700 text-gray-400":r+="bg-gray-900/30 border-gray-600 text-gray-300 hover:border-gray-400",e.jsx("div",{className:r,onClick:()=>xe(s),onMouseEnter:()=>p("hover"),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full border flex items-center justify-center",children:String.fromCharCode(65+a)}),e.jsx("span",{className:"font-mono",children:s})]})},a)})})]}),C&&e.jsxs("div",{className:`mx-8 mb-6 rounded-lg p-6 border ${h?b?"bg-green-900/20 border-green-500/30":"bg-rose-900/20 border-rose-500/30":"bg-blue-900/20 border-blue-500/30"}`,children:[e.jsxs("h4",{className:`font-bold mb-2 flex items-center ${h&&!b?"text-rose-300":"text-green-400"}`,children:[e.jsx(W,{className:"h-5 w-5 mr-2"})," Explanation"]}),e.jsx("p",{className:`${h&&!b?"text-rose-100":"text-green-200"}`,children:h?b?l.explanation_correct:l.explanation_wrong:l.explanation_correct})]}),e.jsxs("div",{className:"bg-gray-900/30 px-8 py-4 flex justify-between",children:[e.jsxs("button",{onClick:()=>{ce(),p("click")},disabled:S===0,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-lg disabled:opacity-50",children:[e.jsx(ve,{className:"h-4 w-4 inline"})," Previous"]}),e.jsxs("div",{className:"text-gray-400 text-sm",children:["Answered ",x.size," / ",o]}),e.jsxs("button",{onClick:()=>{oe(),p("click")},disabled:!l,className:"px-4 py-2 bg-blue-600 text-white rounded-lg disabled:opacity-50",children:[ie?"Finish Question":"Next"," ",e.jsx(Se,{className:"h-4 w-4 inline"})]})]})]})})]})]})]})]})}export{Ke as default};
