import{K as ae,r as l,j as e,L as le}from"./app-DdV1zjJF.js";import{a as x,A as ne,C as I}from"./app-layout-6A5TnUZY.js";import{A as ie}from"./AnimatedBackground-DfTIqLCX.js";import{S as A,a as $,X as p}from"./x-NEUS42iR.js";import{C as re}from"./code-xml-B2Ov1JG4.js";import{S as ce}from"./shield-check-BjNvdL_p.js";import{U as de}from"./users-De-l_6iC.js";import{L as O}from"./loader-circle-BFH6OkxA.js";import{c as q}from"./createLucideIcon-DxOyHgzf.js";import{Z as oe}from"./zap-CPuwbdOi.js";import{T as me}from"./trophy-BJVWx3N9.js";import{M as xe}from"./medal-UuyekGk8.js";import"./utils-jAU0Cazi.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],P=q("CircleCheck",he);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],z=q("History",pe),ue={python:"Python",java:"Java",cpp:"C++"},R=n=>ue[n]??n.toUpperCase(),ge=[{title:"Home",href:"/dashboard"},{title:"Play",href:"#"},{title:"1v1 Matchmaking",href:"/play/matchmaking"}],fe=[{value:"python",label:"Python"},{value:"java",label:"Java"},{value:"cpp",label:"C++"}],je=[{value:"easy",label:"Easy",hint:"Warm-up tasks"},{value:"medium",label:"Medium",hint:"Trickier logic"},{value:"hard",label:"Hard",hint:"Deep problem-solving"}],be={python:"/images/python.png",java:"/images/java.png",cpp:"/images/cpp.png"},ye=n=>{if(!n&&n!==0)return"—";const c=Math.floor(n/60),i=n%60;return c?`${c}m ${i}s`:`${i}s`},Ie=()=>{var F;const{props:n}=ae(),c=(F=n==null?void 0:n.auth)==null?void 0:F.user,[i,B]=l.useState("python"),[o,G]=l.useState("easy"),[d,v]=l.useState(!1),[U,u]=l.useState(1),[w,h]=l.useState(null),[k,g]=l.useState(null),[W,C]=l.useState(0),[Q,D]=l.useState(!1),f=l.useMemo(()=>`presence-queue.${i}.${o}`,[i,o]),[J,j]=l.useState(!1),[X,M]=l.useState(!1),[E,V]=l.useState([]),[L,_]=l.useState(null),[m,K]=l.useState(null),[Y,b]=l.useState(!1),Z=s=>{K(s),b(!0)},y=(s,t)=>{const r=t?`/play/m/${s}?t=${encodeURIComponent(t)}`:`/play/m/${s}`;window.location.href=r};l.useEffect(()=>{if(!d)return;C(0);const s=setInterval(()=>{C(t=>t>=120?(clearInterval(s),g("⏳ Seems like no one is online right now. Try again later!"),T(),t):t+1)},1e3);return()=>clearInterval(s)},[d]),l.useEffect(()=>{if(!d)return;const s=setInterval(()=>{x.post("/api/matchmaking/heartbeat").catch(()=>{})},8e3),t=()=>{try{navigator.sendBeacon("/api/matchmaking/cancel")}catch{}};return window.addEventListener("beforeunload",t),window.addEventListener("pagehide",t),()=>{clearInterval(s),window.removeEventListener("beforeunload",t),window.removeEventListener("pagehide",t),x.post("/api/matchmaking/cancel").catch(()=>{})}},[d]);const T=async()=>{var s;g(null);try{await x.post("/api/matchmaking/cancel")}catch{}finally{v(!1),D(!1),h(null),u(1),C(0);try{(s=window.Echo)==null||s.leave(f)}catch{}}};async function N(s,t){const r=t?await x.post(s,t):await x.post(s);return r&&typeof r=="object"&&"data"in r?r.data:r}const ee=async()=>{var s,t,r;_(null),M(!0);try{const a=await x.get("/api/matchmaking/history",{params:{limit:10}}),te=((s=a==null?void 0:a.data)==null?void 0:s.items)??(a==null?void 0:a.items)??[];V(te)}catch(a){_(((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to load history.")}finally{M(!1)}},H=async()=>{j(!0),await ee()};l.useEffect(()=>{if(!d)return;const s=window.Echo;if(s)return s.join(f).here(t=>u(t.length)).joining(()=>u(t=>t+1)).leaving(()=>u(t=>Math.max(0,t-1))).listen("MatchFound",async()=>{try{const t=await N("/api/matchmaking/poll",{language:i,difficulty:o});"slug"in t&&t.slug&&y(t.slug,t.token)}catch{}}),s.private(`user.${c.id}`).listen("MatchFound",async()=>{try{const t=await N("/api/matchmaking/poll",{language:i,difficulty:o});"slug"in t&&t.slug&&y(t.slug,t.token)}catch{}}),()=>{try{window.Echo.leave(f)}catch{}try{window.Echo.leave(`user.${c.id}`)}catch{}}},[d,f,c==null?void 0:c.id,i,o]);const se=async()=>{var s,t,r;g(null),v(!0),h(null);try{const a=await N("/api/matchmaking/join",{language:i,difficulty:o,resume:!1});if("slug"in a&&a.slug){y(a.slug,a.token);return}"queued"in a&&a.queued||"paired"in a&&a.paired?h(String(c.id)):"ticket_id"in a&&a.ticket_id&&h(String(a.ticket_id))}catch(a){console.error("[JOIN ERROR]",((s=a==null?void 0:a.response)==null?void 0:s.data)||a),g(((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to join matchmaking."),v(!1)}};return l.useEffect(()=>{if(!d)return;let s=!1;const t=async()=>{try{const a=await N("/api/matchmaking/poll",{language:i,difficulty:o});if(!s&&"slug"in a&&a.slug){y(a.slug,a.token);return}}catch{}s||setTimeout(t,1200)},r=setTimeout(t,800);return()=>{s=!0,clearTimeout(r)}},[d,i,o]),e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 -z-10",children:e.jsx(ie,{})}),e.jsxs(ne,{breadcrumbs:ge,children:[e.jsx(le,{title:"1v1 Matchmaking"}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-7 h-7 text-indigo-400"}),e.jsx(re,{className:"w-5 h-5 text-cyan-400"}),e.jsx($,{className:"w-6 h-6 text-emerald-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-400 via-fuchsia-400 to-cyan-400 bg-clip-text text-transparent",children:"1V1 MATCHMAKING"}),e.jsx("p",{className:"text-zinc-400 text-sm",children:"Queue by language & difficulty and get paired instantly."})]})]})}),e.jsxs("div",{className:"rounded-2xl border border-slate-700/60 bg-slate-900/40 shadow-xl",children:[e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"text-sm text-zinc-400",children:"Language"}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:fe.map(s=>{const t=i===s.value;return e.jsxs("button",{onClick:()=>B(s.value),disabled:d,className:["flex items-center justify-center gap-2 px-4 py-3 rounded-xl border transition",t?"border-indigo-500/60 bg-indigo-500/10":"border-slate-700/60 hover:border-slate-600"].join(" "),"aria-pressed":t,children:[e.jsx("img",{src:be[s.value],alt:`${s.label} logo`,className:"w-5 h-5 object-contain",loading:"lazy"}),e.jsx("span",{className:"font-medium",children:s.label})]},s.value)})})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"text-sm text-zinc-400",children:"Difficulty"}),e.jsx("div",{className:"mt-2 grid grid-cols-3 gap-2",children:je.map(s=>{const t=o===s.value;return e.jsx("button",{onClick:()=>G(s.value),disabled:d,className:["px-3 py-3 rounded-xl border text-sm transition",t?"border-emerald-500/60 bg-emerald-500/10":"border-slate-700/60 hover:border-slate-600"].join(" "),"aria-pressed":t,title:s.hint,children:s.label},s.value)})})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsxs("label",{className:"text-sm text-zinc-400 flex items-center gap-2",children:["Mode",e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-zinc-500",children:[e.jsx(ce,{className:"w-3 h-3"})," Token-safe"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"w-full px-4 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"AI-Generated"})]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-slate-800 text-zinc-400",children:"Same prompt for both"})]}),e.jsx("p",{className:"mt-2 text-xs text-zinc-500",children:"A single challenge is generated & frozen server-side so both players get the exact same text & tests."})]})]})]}),e.jsx("div",{className:"border-t border-slate-700/60"}),e.jsxs("div",{className:"p-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(de,{className:"w-4 h-4 text-zinc-400"}),e.jsxs("span",{className:"text-zinc-400",children:["Players waiting in ",e.jsx("span",{className:"font-medium text-zinc-200",children:R(i)})," /",e.jsxs("span",{className:"font-medium text-zinc-200",children:[" ",o]}),":"]}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-lg bg-slate-800 text-zinc-100",children:U})]}),e.jsx("div",{className:"flex items-center gap-3",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 text-zinc-200",children:Q?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 text-emerald-400"}),"Match found! Preparing challenge…"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4 animate-spin"}),"Searching… ",e.jsxs("span",{className:"ml-2 text-xs text-zinc-400",children:[W,"s"]})]})}),e.jsxs("button",{onClick:T,className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-zinc-200",children:[e.jsx(p,{className:"w-4 h-4"})," Cancel"]}),e.jsxs("button",{onClick:H,className:"inline-flex items-center gap-2 px-3 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 hover:bg-slate-800 transition text-zinc-200",type:"button",children:[e.jsx(z,{className:"w-4 h-4"})," History"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:se,className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl bg-gradient-to-r from-cyan-500 to-indigo-600 hover:opacity-95 active:opacity-100 transition text-white font-medium",children:[e.jsx(A,{className:"w-4 h-4"})," Find Match"]}),e.jsxs("button",{onClick:H,className:"inline-flex items-center gap-2 px-3 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 hover:bg-slate-800 transition text-zinc-200",type:"button",children:[e.jsx(z,{className:"w-4 h-4"})," History"]})]})})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(S,{icon:e.jsx(I,{className:"w-4 h-4"}),title:"Speed wins",text:"Winner is the first to submit a correct solution. Ties decided by time to correct."}),e.jsx(S,{icon:e.jsx(oe,{className:"w-4 h-4"}),title:"No code mirroring",text:"You only see your own editor. Opponent panel shows status/animations only."}),e.jsx(S,{icon:e.jsx(me,{className:"w-4 h-4"}),title:"XP rules",text:"Base XP by difficulty; minus 0.5 if you used a hint (server-enforced)."})]}),(k||w)&&e.jsxs("div",{className:"mt-6 flex flex-col gap-2",children:[k&&e.jsxs("div",{className:"flex items-center gap-2 text-red-300 bg-red-900/20 border border-red-900/40 px-3 py-2 rounded-lg",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:k})]}),w&&e.jsxs("div",{className:"flex items-center gap-2 text-emerald-300 bg-emerald-900/20 border border-emerald-900/40 px-3 py-2 rounded-lg",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:["Queued (ticket #",w,"). You’ll auto-join when a match is found."]})]})]})]}),J&&e.jsxs("div",{className:"fixed inset-0 z-[999] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>j(!1)}),e.jsxs("div",{className:"relative w-full max-w-3xl mx-4 rounded-2xl border border-slate-700/60 bg-slate-900/90 backdrop-blur p-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-indigo-400"}),e.jsx("h2",{className:"text-lg font-semibold text-zinc-100",children:"Recent 1v1 History"})]}),e.jsx("button",{onClick:()=>j(!1),className:"p-2 rounded-lg hover:bg-slate-800","aria-label":"Close",children:e.jsx(p,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"mt-3 px-2 max-h-[70vh] overflow-y-auto scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:X?e.jsxs("div",{className:"flex items-center gap-2 text-zinc-400",children:[e.jsx(O,{className:"w-4 h-4 animate-spin"})," Loading…"]}):L?e.jsx("div",{className:"text-red-300 bg-red-900/20 border border-red-900/40 px-3 py-2 rounded-lg",children:L}):E.length===0?e.jsx("div",{className:"text-zinc-400 py-6 text-center",children:"No recent matches yet."}):e.jsx("ul",{className:"divide-y divide-slate-700/50",children:E.map(s=>{var t;return e.jsxs("li",{className:"py-3 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.is_winner?e.jsxs("span",{className:"inline-flex items-center gap-1 text-emerald-300",children:[e.jsx(xe,{className:"w-4 h-4"})," Win"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-300",children:[e.jsx(p,{className:"w-4 h-4"})," Loss"]}),e.jsxs("span",{className:"text-zinc-300",children:["vs ",e.jsx("span",{className:"font-medium",children:(t=s.opponent)==null?void 0:t.name})]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-zinc-500",children:[e.jsx("span",{className:"px-2 py-0.5 rounded bg-slate-800 border border-slate-700/60",children:R(s.language||"")}),s.difficulty&&e.jsx("span",{className:"px-2 py-0.5 rounded bg-slate-800 border border-slate-700/60 capitalize",children:s.difficulty}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"})," ",ye(s.time_spent_sec)]}),s.finished_at&&e.jsx("span",{children:new Date(s.finished_at).toLocaleString()})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.challenge?e.jsx("button",{onClick:()=>Z(s.challenge),className:"text-xs px-3 py-1 rounded-lg border border-slate-700/60 hover:bg-slate-800 text-zinc-200",children:"View"}):s.match_public_id?e.jsx("a",{href:`/play/m/${s.match_public_id}`,className:"text-xs px-3 py-1 rounded-lg border border-slate-700/60 hover:bg-slate-800 text-zinc-200",children:"View"}):null})]},s.id)})})}),e.jsx("div",{className:"mt-3 flex items-center justify-end gap-2 px-2 border-t border-slate-700/60 pt-3",children:e.jsx("button",{onClick:()=>j(!1),className:"px-3 py-2 rounded-lg border border-slate-700/60 hover:bg-slate-800 text-zinc-200",children:"Close"})})]})]}),Y&&m&&e.jsxs("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>b(!1)}),e.jsxs("div",{className:"relative w-full max-w-2xl mx-4 rounded-2xl border border-slate-700/60 bg-slate-900/90 backdrop-blur p-5 max-h-[80vh] overflow-y-auto scrollbar-hide",style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-indigo-400",children:m.title||"Challenge Info"}),e.jsx("button",{onClick:()=>b(!1),className:"p-2 rounded-lg hover:bg-slate-800",children:e.jsx(p,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mt-3 text-sm text-zinc-300 space-y-3",children:[m.description&&e.jsx("p",{className:"text-zinc-400",children:m.description}),m.buggy_code&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-zinc-200 font-medium",children:"Buggy Code:"}),e.jsx("pre",{className:"p-3 bg-slate-800 rounded-lg text-xs overflow-auto text-zinc-300 whitespace-pre-wrap max-h-[200px]",children:m.buggy_code})]}),m.fixed_code&&e.jsxs(e.Fragment,{children:[e.jsx("h4",{className:"text-zinc-200 font-medium mt-2",children:"Fixed Code:"}),e.jsx("pre",{className:"p-3 bg-slate-800 rounded-lg text-xs overflow-auto text-zinc-300 whitespace-pre-wrap max-h-[200px]",children:m.fixed_code})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 rounded-lg border border-slate-700/60 hover:bg-slate-800 text-zinc-200",children:"Close"})})]})]})]})]})},S=({icon:n,title:c,text:i})=>e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-zinc-300",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-lg bg-slate-800",children:n}),e.jsx("span",{className:"text-sm font-medium",children:c})]}),e.jsx("p",{className:"mt-2 text-xs text-zinc-500",children:i})]}),Ne=document.createElement("style");document.head.appendChild(Ne);if(typeof document<"u"){const n=document.createElement("style");n.innerHTML=`
    .scrollbar-hide::-webkit-scrollbar { display: none; }
  `,document.head.appendChild(n)}export{Ie as default};
