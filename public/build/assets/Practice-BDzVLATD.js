import{K as oe,r as n}from"./app-Dl0wFmr7.js";import{a as M,S as j}from"./sweetalert2.esm.all-C4Ccwgm9.js";import"./utils-jAU0Cazi.js";const v=["python","java","cpp"],q=j.mixin({buttonsStyling:!1,background:"#0f172a",color:"#e5e7eb",iconColor:"#22d3ee",customClass:{popup:"bg-slate-900 text-slate-200 border border-slate-700 rounded-2xl shadow-2xl",title:"text-slate-100 font-semibold text-xl",htmlContainer:"text-slate-300 leading-relaxed",confirmButton:"px-4 py-2 rounded-lg bg-violet-600 hover:bg-violet-700 text-white font-medium shadow",cancelButton:"px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-100 font-medium ml-2",denyButton:"px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-100 font-medium ml-2"}}),R=(S,g=2500)=>j.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:g,timerProgressBar:!0,background:"transparent",customClass:{popup:"!p-0 !bg-transparent !shadow-none !border-0",timerProgressBar:"bg-yellow-500/50"},html:`
      <div class="flex items-center gap-3 rounded-xl border border-yellow-700 bg-slate-900/90 backdrop-blur px-4 py-3 shadow-2xl">
        <div class="p-2 rounded-lg border border-yellow-700 bg-yellow-500/10">
          <!-- Info icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8"  x2="12" y2="8"></line>
          </svg>
        </div>
        <p class="text-sm text-white font-semibold">${S}</p>
      </div>
    `});function he(){var F,Q;const{auth:S}=oe().props;S==null||S.user;const[g,L]=n.useState([]),[x,D]=n.useState([]),[I,p]=n.useState(0),[K,U]=n.useState(null),[W,X]=n.useState(!1),[ie,z]=n.useState(!1),[k,H]=n.useState("python"),[u,A]=n.useState("all"),[N,Y]=n.useState(""),[re,$]=n.useState(!0),[le,J]=n.useState([]),[m,V]=n.useState(new Set),[T,Z]=n.useState(0),b=n.useRef(null),B=n.useRef(null),w=n.useRef(null),[ee,te]=n.useState(null),O=((F=document.querySelector('meta[name="csrf-token"]'))==null?void 0:F.content)||((Q=window.Laravel)==null?void 0:Q.csrfToken)||"",se={"Content-Type":"application/json","X-CSRF-TOKEN":O,"X-Requested-With":"XMLHttpRequest"},P=n.useRef(!0),ne=async i=>{if(!(!i||!w.current||!P.current))try{(await fetch("/practice/position",{method:"POST",credentials:"same-origin",headers:se,body:JSON.stringify({question_set_id:w.current.id,last_question_id:i})})).status===404&&(P.current=!1)}catch{}},[ce,de]=n.useState(!0);n.useRef(null),n.useEffect(()=>{y()},[k]),n.useEffect(()=>{ae()},[g,u,N,m]),n.useEffect(()=>{if(w.current&&T>0&&m.size>=T){const{id:i,set_index:a,language:e}=w.current;fetch("/practice/finish",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":O},body:JSON.stringify({question_set_id:i})}).catch(()=>{}).finally(async()=>{try{const t=await(await fetch(`/practice/sets?language=${e}`,{credentials:"same-origin"})).json(),l=(Array.isArray(t==null?void 0:t.sets)?t.sets:[]).find(s=>s.set_index>a);if(l){try{M.play("success")}catch{}(await q.fire({icon:"success",title:"ðŸŽ‰ Congratulations!",html:`<div class="text-left">
                  <p>Youâ€™ve finished <b>Set #${a}</b> (${e}).</p>
                  <p class="mt-2">The next set <b>#${l.set_index}</b> is available. Ready to continue?</p>
                </div>`,confirmButtonText:`Start Set #${l.set_index}`,showCancelButton:!0,cancelButtonText:"Later"})).isConfirmed&&y()}else{try{M.play("success")}catch{}await q.fire({icon:"success",title:"ðŸŽ‰ Great job!",html:`<div class="text-left">
                  <p>Youâ€™ve finished <b>Set #${a}</b> (${e}).</p>
                  <p class="mt-2">No next set is uploaded yet. <b>Stay tuned</b> for more questions!</p>
                </div>`,confirmButtonText:"Okay"})}}catch{y()}})}},[m,T]),n.useEffect(()=>{var a;const i=((a=x[I])==null?void 0:a.id)??null;i&&(b.current=i,ne(i))},[I,x]);const y=async()=>{var a;const i=new AbortController;try{$(!0);const e=await fetch(`/practice/current?language=${k}`,{signal:i.signal,credentials:"same-origin"});if(!e.ok)throw e.status===404?{code:"NO_SET"}:e.status===401||e.status===419?{code:"SESSION"}:{code:"GENERIC"};const c=await e.json(),{set:t,progress:r}=c;w.current={id:t.id,filename:t.filename,total_questions:t.total_questions,set_index:t.set_index,language:t.language},Z(t.total_questions||0),b.current=(r==null?void 0:r.last_question_id)??null;const l=await fetch(`/data/${t.filename}`,{signal:i.signal,credentials:"same-origin"});if(!l.ok)throw l.status===404?{code:"FILE_MISSING",filename:t.filename,setIndex:t.set_index,lang:t.language}:{code:"GENERIC"};const s=await l.json();L(s),J([...new Set(s.map(d=>d.category))]);const o=new Set(s.map(d=>d.id));if(o.size!==s.length){const d=new Set,C=[];s.forEach(f=>{d.has(f.id)?C.push(f.id):d.add(f.id)}),console.warn("[Practice] Duplicate or missing IDs detected",{file:(a=w.current)==null?void 0:a.filename,totalRows:s.length,uniqueIds:o.size,duplicates:Array.from(new Set(C))})}const h=Array.isArray(r==null?void 0:r.taken_ids)?r.taken_ids:[];V(new Set(h)),E()}catch(e){if((e==null?void 0:e.name)==="AbortError")return;console.error("Error loading questions:",e),L([]);const c=((e==null?void 0:e.code)??"GENERIC")+":"+((e==null?void 0:e.setIndex)??"")+":"+((e==null?void 0:e.lang)??""),t=B.current===c;t||(B.current=c);const r=v.indexOf(k),l=v[(r+1)%v.length];let s="Canâ€™t load questions",o="We ran into a hiccup loading this practice set. Please try again.",h="Retry",d=!1,C="",f=()=>y();switch(e==null?void 0:e.code){case"NO_SET":s="Practice set coming soon",o=`Weâ€™re preparing the next <b>${k}</b> question set. Check back soon!`,h="Got it",f=null,d=!0,C=`Try ${l.toUpperCase()}`;break;case"FILE_MISSING":s="Updating questions",o=`Weâ€™re updating <b>Set #${e.setIndex}</b> (${e.lang}). Please try again a little later.`,h="Retry",f=()=>y();break;case"SESSION":s="Session expired",o="Please refresh the page and sign in again.",h="Refresh",f=()=>window.location.reload();break;default:s="Canâ€™t load questions",o="Looks like a network hiccup. Please try again.",h="Retry",f=()=>y();break}if(t)R((e==null?void 0:e.code)==="FILE_MISSING"?"Still updating â€” please check back later.":"Still canâ€™t load â€” try again soon.");else{const G=await q.fire({icon:"info",title:s,html:o,confirmButtonText:h,showDenyButton:d,denyButtonText:C});G.isConfirmed&&f&&await f(),G.isDenied&&H(l)}}finally{$(!1)}},ae=()=>{const i=N.trim().toLowerCase();let a=g.filter(e=>!m.has(e.id));if(u!=="all"&&(a=a.filter(e=>e.category===u)),i&&(a=a.filter(e=>e.question.toLowerCase().includes(i)||e.category.toLowerCase().includes(i))),D(a),a.length===0){const e=new Map;for(const t of g)m.has(t.id)||e.set(t.category,(e.get(t.category)??0)+1);if(Array.from(e.values()).reduce((t,r)=>t+r,0)>0){if(u!=="all"){const t=Array.from(new Set(g.map(o=>o.category))).sort(),r=Math.max(0,t.indexOf(u)),s=[...t.slice(r+1),...t.slice(0,r)].find(o=>(e.get(o)??0)>0);if(s){R(`Finished "${u}". Switching to "${s}".`),A(s),p(0),E();return}R(`Finished "${u}". Showing remaining questions.`),A("all"),p(0),E();return}if(u==="all"&&i){R("No matches for this search. Clearing search to continue."),Y(""),p(0),E();return}}p(0);return}if(b.current!=null){const e=b.current;let c=null;const t={};g.forEach((s,o)=>t[s.id]=o);const r=t[e]??-1;for(let s=r+1;s<g.length;s++){const o=g[s],h=u==="all"||o.category===u,d=!i||o.question.toLowerCase().includes(i)||o.category.toLowerCase().includes(i);if(!m.has(o.id)&&h&&d){c=o.id;break}}c==null&&(c=a[0].id);const l=a.findIndex(s=>s.id===c);p(l>=0?l:0),b.current=null}else p(e=>Math.min(e,Math.max(0,a.length-1)))},E=()=>{U(null),X(!1),z(!1),te(null)},_=x[I];W&&_&&ee===_.id&&_.answer,x.length===1||x.length-1}export{he as default};
