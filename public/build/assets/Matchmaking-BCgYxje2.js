import{K as _,r as c,j as e,L as q}from"./app-Cp-RWcHt.js";import{a as v,A as Q,C as R}from"./app-layout-Dflh3KzS.js";import{A as U}from"./AnimatedBackground-D9EpzAVb.js";import{S,a as z,X as E}from"./x-XMNDshmE.js";import{C as M}from"./code-xml-DN--Fcv-.js";import{S as B}from"./shield-check-CyjptulJ.js";import{U as G}from"./users-FO9bXr7b.js";import{L as J}from"./loader-circle-CmkQt5VF.js";import{c as O}from"./createLucideIcon-CjgJ8weP.js";import{Z as X}from"./zap-X2rJqtor.js";import{T as D}from"./trophy-DCbBq78o.js";import"./utils-jAU0Cazi.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],T=O("CircleCheck",H),W={python:"Python",java:"Java",cpp:"C++"},K=d=>W[d]??d.toUpperCase(),Y=[{title:"Home",href:"/dashboard"},{title:"Play",href:"#"},{title:"1v1 Matchmaking",href:"/play/matchmaking"}],Z=[{value:"python",label:"Python"},{value:"java",label:"Java"},{value:"cpp",label:"C++"}],V=[{value:"easy",label:"Easy",hint:"Warm-up tasks"},{value:"medium",label:"Medium",hint:"Trickier logic"},{value:"hard",label:"Hard",hint:"Deep problem-solving"}],xe=()=>{var C;const{props:d}=_(),n=(C=d==null?void 0:d.auth)==null?void 0:C.user,[i,L]=c.useState("python"),[l,A]=c.useState("easy"),[o,f]=c.useState(!1),[F,m]=c.useState(1),[j,p]=c.useState(null),[y,g]=c.useState(null),[I,N]=c.useState(0),[$,b]=c.useState(!1),x=c.useMemo(()=>`presence-queue.${i}.${l}`,[i,l]),u=(a,s)=>{const r=s?`/play/m/${a}?t=${encodeURIComponent(s)}`:`/play/m/${a}`;window.location.href=r};c.useEffect(()=>{if(!o)return;N(0);const a=setInterval(()=>{N(s=>s>=120?(clearInterval(a),g("⏳ Seems like no one is online right now. Try again later!"),k(),s):s+1)},1e3);return()=>clearInterval(a)},[o]),c.useEffect(()=>{if(!o)return;const a=window.Echo;if(a)return a.join(x).here(s=>m(s.length)).joining(()=>m(s=>s+1)).leaving(()=>m(s=>Math.max(1,s-1))).listen("MatchFound",async()=>{b(!0);try{const s=await h("/api/matchmaking/poll",{language:i,difficulty:l});"slug"in s&&s.slug&&u(s.slug,s.token)}catch{}}),a.private(`user.${n.id}`).listen("MatchFound",async()=>{b(!0);try{const s=await h("/api/matchmaking/poll",{language:i,difficulty:l});"slug"in s&&s.slug&&u(s.slug,s.token)}catch{}}),()=>{try{a.leave(x)}catch{}try{a.leave(`user.${n.id}`)}catch{}}},[o,x,n==null?void 0:n.id,i,l]);const k=async()=>{var a;g(null);try{await v.post("/api/matchmaking/cancel")}catch{}finally{f(!1),b(!1),p(null),m(1),N(0);try{(a=window.Echo)==null||a.leave(x)}catch{}}};async function h(a,s){const r=s?await v.post(a,s):await v.post(a);return r&&typeof r=="object"&&"data"in r?r.data:r}c.useEffect(()=>{if(!o)return;const a=window.Echo;if(a)return a.join(x).here(s=>m(s.length)).joining(()=>m(s=>s+1)).leaving(()=>m(s=>Math.max(1,s-1))).listen("MatchFound",async()=>{try{const s=await h("/api/matchmaking/poll",{language:i,difficulty:l});"slug"in s&&s.slug&&u(s.slug,s.token)}catch{}}),a.private(`user.${n.id}`).listen("MatchFound",async()=>{try{const s=await h("/api/matchmaking/poll",{language:i,difficulty:l});"slug"in s&&s.slug&&u(s.slug,s.token)}catch{}}),()=>{try{window.Echo.leave(x)}catch{}try{window.Echo.leave(`user.${n.id}`)}catch{}}},[o,x,n==null?void 0:n.id,i,l]);const P=async()=>{var a,s,r;g(null),f(!0),p(null);try{const t=await h("/api/matchmaking/join",{language:i,difficulty:l,resume:!1});if("slug"in t&&t.slug){u(t.slug,t.token);return}"queued"in t&&t.queued||"paired"in t&&t.paired?p(String(n.id)):"ticket_id"in t&&t.ticket_id&&p(String(t.ticket_id))}catch(t){console.error("[JOIN ERROR]",((a=t==null?void 0:t.response)==null?void 0:a.data)||t),g(((r=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to join matchmaking."),f(!1)}};return c.useEffect(()=>{if(!o)return;let a=!1;const s=async()=>{try{const t=await h("/api/matchmaking/poll",{language:i,difficulty:l});if(!a&&"slug"in t&&t.slug){u(t.slug,t.token);return}}catch{}a||setTimeout(s,1200)},r=setTimeout(s,800);return()=>{a=!0,clearTimeout(r)}},[o,i,l]),e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 -z-10",children:e.jsx(U,{})}),e.jsxs(Q,{breadcrumbs:Y,children:[e.jsx(q,{title:"1v1 Matchmaking"}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"w-7 h-7 text-indigo-400"}),e.jsx(M,{className:"w-5 h-5 text-cyan-400"}),e.jsx(z,{className:"w-6 h-6 text-emerald-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-400 via-fuchsia-400 to-cyan-400 bg-clip-text text-transparent",children:"1V1 MATCHMAKING"}),e.jsx("p",{className:"text-zinc-400 text-sm",children:"Queue by language & difficulty and get paired instantly."})]})]})}),e.jsxs("div",{className:"rounded-2xl border border-slate-700/60 bg-slate-900/40 shadow-xl",children:[e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"text-sm text-zinc-400",children:"Language"}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:Z.map(a=>{const s=i===a.value;return e.jsxs("button",{onClick:()=>L(a.value),disabled:o,className:["flex items-center justify-center gap-2 px-4 py-3 rounded-xl border transition",s?"border-indigo-500/60 bg-indigo-500/10":"border-slate-700/60 hover:border-slate-600"].join(" "),"aria-pressed":s,children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:a.label})]},a.value)})})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"text-sm text-zinc-400",children:"Difficulty"}),e.jsx("div",{className:"mt-2 grid grid-cols-3 gap-2",children:V.map(a=>{const s=l===a.value;return e.jsx("button",{onClick:()=>A(a.value),disabled:o,className:["px-3 py-3 rounded-xl border text-sm transition",s?"border-emerald-500/60 bg-emerald-500/10":"border-slate-700/60 hover:border-slate-600"].join(" "),"aria-pressed":s,title:a.hint,children:a.label},a.value)})})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsxs("label",{className:"text-sm text-zinc-400 flex items-center gap-2",children:["Mode",e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-zinc-500",children:[e.jsx(B,{className:"w-3 h-3"})," Token-safe"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"w-full px-4 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"AI-Generated"})]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-slate-800 text-zinc-400",children:"Same prompt for both"})]}),e.jsx("p",{className:"mt-2 text-xs text-zinc-500",children:"A single challenge is generated & frozen server-side so both players get the exact same text & tests."})]})]})]}),e.jsx("div",{className:"border-t border-slate-700/60"}),e.jsxs("div",{className:"p-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(G,{className:"w-4 h-4 text-zinc-400"}),e.jsxs("span",{className:"text-zinc-400",children:["Players waiting in ",e.jsx("span",{className:"font-medium text-zinc-200",children:K(i)})," /",e.jsxs("span",{className:"font-medium text-zinc-200",children:[" ",l]}),":"]}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-lg bg-slate-800 text-zinc-100",children:F})]}),e.jsx("div",{className:"flex items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 text-zinc-200",children:$?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 text-emerald-400"}),"Match found! Preparing challenge…"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 animate-spin"}),"Searching… ",e.jsxs("span",{className:"ml-2 text-xs text-zinc-400",children:[I,"s"]})]})}),e.jsxs("button",{onClick:k,className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-zinc-200",children:[e.jsx(E,{className:"w-4 h-4"})," Cancel"]})]}):e.jsxs("button",{onClick:P,className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl bg-gradient-to-r from-cyan-500 to-indigo-600 hover:opacity-95 active:opacity-100 transition text-white font-medium",children:[e.jsx(S,{className:"w-4 h-4"})," Find Match"]})})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(w,{icon:e.jsx(R,{className:"w-4 h-4"}),title:"Speed wins",text:"Winner is the first to submit a correct solution. Ties decided by time to correct."}),e.jsx(w,{icon:e.jsx(X,{className:"w-4 h-4"}),title:"No code mirroring",text:"You only see your own editor. Opponent panel shows status/animations only."}),e.jsx(w,{icon:e.jsx(D,{className:"w-4 h-4"}),title:"XP rules",text:"Base XP by difficulty; minus 0.5 if you used a hint (server-enforced)."})]}),(y||j)&&e.jsxs("div",{className:"mt-6 flex flex-col gap-2",children:[y&&e.jsxs("div",{className:"flex items-center gap-2 text-red-300 bg-red-900/20 border border-red-900/40 px-3 py-2 rounded-lg",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:y})]}),j&&e.jsxs("div",{className:"flex items-center gap-2 text-emerald-300 bg-emerald-900/20 border border-emerald-900/40 px-3 py-2 rounded-lg",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:["Queued (ticket #",j,"). You’ll auto-join when a match is found."]})]})]})]})]})]})},w=({icon:d,title:n,text:i})=>e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-zinc-300",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-lg bg-slate-800",children:d}),e.jsx("span",{className:"text-sm font-medium",children:n})]}),e.jsx("p",{className:"mt-2 text-xs text-zinc-500",children:i})]});export{xe as default};
