import{K as ge,r as i,j as e,L as J}from"./app-S8Gj7UnV.js";import{b as F,A as U}from"./app-layout-D6P1xQZ2.js";import{S as _}from"./sweetalert2.esm.all-acGi8jXx.js";import{A as fe}from"./AnimatedBackground-t4u2Crfz.js";import{R as pe}from"./refresh-cw-CCkzvxAg.js";import{B as ye,X as be}from"./x-aBnHjvD1.js";import{C as V}from"./users-CrWWAf5S.js";import{L as Z}from"./lightbulb-Dc6WqI1O.js";import{F as je}from"./filter-BaDApA0Z.js";import{S as we}from"./search-DRuJyQxY.js";import{C as Ne}from"./chart-column-DCuvQRH7.js";import{E as ve}from"./eye-off-DTDxDrmY.js";import{E as Se}from"./eye-DeI00IeP.js";import{C as Ce}from"./circle-check-big-DClANhSw.js";import{A as ke}from"./arrow-left-B735STuE.js";import{A as Ie}from"./arrow-right-D4E_j_q3.js";import"./utils-jAU0Cazi.js";import"./createLucideIcon-nHfNlitK.js";const ee=[{title:"Home",href:"/dashboard"},{title:"Practice",href:"#"},{title:"Review Mode",href:"/play/practice"}],Q=["python","java","cpp"];function Xe(){var X,Y;const{auth:L}=ge().props;L==null||L.user;const[S,O]=i.useState([]),[E,te]=i.useState([]),[R,C]=i.useState(0),[B,z]=i.useState(null),[p,G]=i.useState(!1),[A,q]=i.useState(!1),[w,M]=i.useState("python"),[y,se]=i.useState("all"),[P,ae]=i.useState(""),[ne,D]=i.useState(!0),[re,ie]=i.useState([]),[g,$]=i.useState(new Set),[m,le]=i.useState(0),k=i.useRef(null),W=i.useRef(null),N=i.useRef(null),K=((X=document.querySelector('meta[name="csrf-token"]'))==null?void 0:X.content)||((Y=window.Laravel)==null?void 0:Y.csrfToken)||"",[oe,Ee]=i.useState(!0);i.useRef(null);const b=s=>{if(oe)try{F.play(s)}catch{}};i.useEffect(()=>{v()},[w]),i.useEffect(()=>{ce()},[S,y,P,g]),i.useEffect(()=>{if(N.current&&m>0&&g.size>=m){const{id:s,set_index:n,language:t}=N.current;fetch("/practice/finish",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":K},body:JSON.stringify({question_set_id:s})}).catch(()=>{}).finally(async()=>{try{const a=await(await fetch(`/practice/sets?language=${t}`,{credentials:"same-origin"})).json(),c=(Array.isArray(a==null?void 0:a.sets)?a.sets:[]).find(r=>r.set_index>n);if(c){try{F.play("success")}catch{}(await _.fire({icon:"success",title:"ðŸŽ‰ Congratulations!",html:`<div class="text-left">
              <p>Youâ€™ve finished <b>Set #${n}</b> (${t}).</p>
              <p class="mt-2">The next set <b>#${c.set_index}</b> is available. Ready to continue?</p>
            </div>`,confirmButtonText:`Start Set #${c.set_index}`,showCancelButton:!0,cancelButtonText:"Later",customClass:{popup:"bg-gray-900 text-gray-100"}})).isConfirmed&&v()}else{try{F.play("success")}catch{}await _.fire({icon:"success",title:"ðŸŽ‰ Great job!",html:`<div class="text-left">
              <p>Youâ€™ve finished <b>Set #${n}</b> (${t}).</p>
              <p class="mt-2">No next set is uploaded yet. <b>Stay tuned</b> for more questions!</p>
            </div>`,confirmButtonText:"Okay",customClass:{popup:"bg-gray-900 text-gray-100"}})}}catch{v()}})}},[g,m]);const v=async()=>{var n;const s=new AbortController;try{D(!0);const t=await fetch(`/practice/current?language=${w}`,{signal:s.signal,credentials:"same-origin"});if(!t.ok)throw t.status===404?{code:"NO_SET"}:t.status===401||t.status===419?{code:"SESSION"}:{code:"GENERIC"};const d=await t.json(),{set:a,progress:u}=d;N.current={id:a.id,filename:a.filename,total_questions:a.total_questions,set_index:a.set_index,language:a.language},le(a.total_questions||0),k.current=(u==null?void 0:u.last_question_id)??null;const c=await fetch(`/data/${a.filename}`,{signal:s.signal,credentials:"same-origin"});if(!c.ok)throw c.status===404?{code:"FILE_MISSING",filename:a.filename,setIndex:a.set_index,lang:a.language}:{code:"GENERIC"};const r=await c.json();O(r),ie([...new Set(r.map(x=>x.category))]);const o=new Set(r.map(x=>x.id));if(o.size!==r.length){const x=new Set,I=[];r.forEach(h=>{x.has(h.id)?I.push(h.id):x.add(h.id)}),console.warn("[Practice] Duplicate or missing IDs detected",{file:(n=N.current)==null?void 0:n.filename,totalRows:r.length,uniqueIds:o.size,duplicates:Array.from(new Set(I))})}const f=Array.isArray(u==null?void 0:u.taken_ids)?u.taken_ids:[];$(new Set(f)),T()}catch(t){if((t==null?void 0:t.name)==="AbortError")return;console.error("Error loading questions:",t),O([]);const d=((t==null?void 0:t.code)??"GENERIC")+":"+((t==null?void 0:t.setIndex)??"")+":"+((t==null?void 0:t.lang)??""),a=W.current===d;a||(W.current=d);const u=Q.indexOf(w),c=Q[(u+1)%Q.length];let r="Canâ€™t load questions",o="We ran into a hiccup loading this practice set. Please try again.",f="Retry",x=!1,I="",h=()=>v();switch(t==null?void 0:t.code){case"NO_SET":r="Practice set coming soon",o=`Weâ€™re preparing the next <b>${w}</b> question set. Check back soon!`,f="Got it",h=null,x=!0,I=`Try ${c.toUpperCase()}`;break;case"FILE_MISSING":r="Updating questions",o=`Weâ€™re updating <b>Set #${t.setIndex}</b> (${t.lang}). Please try again a little later.`,f="Retry",h=()=>v();break;case"SESSION":r="Session expired",o="Please refresh the page and sign in again.",f="Refresh",h=()=>window.location.reload();break;default:r="Canâ€™t load questions",o="Looks like a network hiccup. Please try again.",f="Retry",h=()=>v();break}if(a)_.fire({toast:!0,position:"top-end",icon:"info",title:(t==null?void 0:t.code)==="FILE_MISSING"?"Still updating â€” please check back later.":"Still canâ€™t load â€” try again soon.",showConfirmButton:!1,timer:2e3});else{const H=await _.fire({icon:"info",title:r,html:o,confirmButtonText:f,showDenyButton:x,denyButtonText:I,customClass:{popup:"bg-gray-900 text-gray-100"}});H.isConfirmed&&h&&await h(),H.isDenied&&M(c)}}finally{D(!1)}},ce=()=>{const s=P.trim().toLowerCase();let n=S.filter(t=>!g.has(t.id));if(y!=="all"&&(n=n.filter(t=>t.category===y)),s&&(n=n.filter(t=>t.question.toLowerCase().includes(s)||t.category.toLowerCase().includes(s))),te(n),n.length===0){C(0);return}if(k.current!=null){const t=k.current;let d=null;const a={};S.forEach((r,o)=>a[r.id]=o);const u=a[t]??-1;for(let r=u+1;r<S.length;r++){const o=S[r],f=y==="all"||o.category===y,x=!s||o.question.toLowerCase().includes(s)||o.category.toLowerCase().includes(s);if(!g.has(o.id)&&f&&x){d=o.id;break}}d==null&&(d=n[0].id);const c=n.findIndex(r=>r.id===d);C(c>=0?c:0),k.current=null}else C(t=>Math.min(t,Math.max(0,n.length-1)))},T=()=>{z(null),G(!1),q(!1)},l=E[R],j=p&&B===(l==null?void 0:l.answer),de=E.length===1||R===E.length-1,ue=async()=>{if(l&&N.current){$(s=>{const n=new Set(s);return n.add(l.id),n});try{await fetch("/practice/taken",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":K},body:JSON.stringify({question_set_id:N.current.id,question_id:l.id})}),k.current=l.id}catch(s){console.error("Failed to mark taken",s)}}T()},xe=()=>{R>0&&(C(s=>s-1),T())},me=()=>q(s=>!s),he=s=>{p||!l||(b("click"),z(s),G(!0),q(!0),s===l.answer?b("success"):b("failure"))};return ne?e.jsxs(U,{breadcrumbs:ee,children:[e.jsx(J,{title:"Practice Review"}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(pe,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-blue-400"}),e.jsx("div",{className:"text-gray-300",children:"Loading questions..."})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx(fe,{}),e.jsxs(U,{breadcrumbs:ee,children:[e.jsx(J,{title:"Practice Review"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4 relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ye,{className:"h-8 w-8 text-blue-400"}),e.jsx(V,{className:"h-6 w-6 text-purple-400"}),e.jsx(Z,{className:"h-8 w-8 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"PRACTICE REVIEW"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Review programming questions and learn from explanations"})]})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"lg:w-1/3 flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(je,{className:"h-5 w-5 text-purple-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Question Filters"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Language"}),e.jsxs("select",{value:w,onChange:s=>M(s.target.value),className:"w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200",children:[e.jsx("option",{value:"python",children:"Python"}),e.jsx("option",{value:"java",children:"Java"}),e.jsx("option",{value:"cpp",children:"C++"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Category"}),e.jsxs("select",{value:y,onChange:s=>se(s.target.value),className:"w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200",children:[e.jsx("option",{value:"all",children:"All Categories"}),re.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search...",value:P,onChange:s=>ae(s.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200 placeholder-gray-400"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ne,{className:"h-5 w-5 text-green-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Session Stats"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Total Questions:"}),e.jsx("span",{className:"text-blue-300 font-medium",children:m})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Current Progress:"}),e.jsxs("span",{className:"text-purple-300 font-medium",children:[g.size,"/",m]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Language:"}),e.jsx("span",{className:"text-green-300 font-medium capitalize",children:w})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Category:"}),e.jsx("span",{className:"text-yellow-300 font-medium",children:y==="all"?"All":y})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[e.jsx("span",{children:"Completion"}),e.jsxs("span",{children:[m>0?Math.round(g.size/m*100):0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${m>0?Math.round(g.size/m*100):0}%`}})})]})]})]}),e.jsx("div",{className:"lg:w-2/3",children:E.length===0?e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-12 text-center",children:[e.jsx(V,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl text-gray-300 mb-2",children:"No Questions Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"You may have completed all questions for this set/filter."}),e.jsx("button",{onClick:()=>{$(new Set),C(0),T()},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:"Revisit Questions in This Set"})]}):l&&e.jsxs("div",{className:"bg-gray-900/60 rounded-xl shadow-lg overflow-hidden border border-gray-700",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 flex items-center justify-between",children:[e.jsx("div",{className:"bg-white/20 px-3 py-1 rounded-full text-white text-sm font-medium shadow-md",children:l.category}),e.jsxs("button",{onClick:()=>{me(),b("hover")},className:"flex items-center space-x-2 px-4 py-2 bg-white/10 hover:bg-white/20 text-white font-medium rounded-lg shadow transition",children:[A?e.jsx(ve,{className:"h-4 w-4"}):e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{children:A?"Hide Answer":"Show Answer"})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsx("div",{className:"mb-6 p-4 bg-gray-800/40 border border-gray-700 rounded-lg",children:e.jsx("p",{className:"text-xl text-white font-semibold leading-relaxed whitespace-pre-line",children:l.question.split(/(`[^`]+`)/g).map((s,n)=>s.startsWith("`")?e.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded text-purple-300 font-mono text-base",children:s.replace(/`/g,"")},n):s)})}),p&&e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold ${j?"bg-green-900/40 text-green-200":"bg-rose-900/40 text-rose-200"}`,children:[j?e.jsx(Ce,{className:"h-4 w-4"}):e.jsx(be,{className:"h-4 w-4"}),j?"Correct":"Incorrect"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-6",children:l.choices.map((s,n)=>{const t=s===l.answer,d=s===B;let a="p-4 rounded-lg border cursor-pointer transition-all ";return A?t?a+="bg-green-900/50 border-green-400 text-green-100":p&&d&&!t?a+="bg-rose-900/50 border-rose-400 text-rose-100":a+="bg-gray-900/20 border-gray-700 text-gray-400":a+="bg-gray-900/30 border-gray-600 text-gray-300 hover:border-gray-400",e.jsx("div",{className:a,onClick:()=>he(s),onMouseEnter:()=>b("hover"),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full border flex items-center justify-center",children:String.fromCharCode(65+n)}),e.jsx("span",{className:"font-mono",children:s})]})},n)})})]}),A&&e.jsxs("div",{className:`mx-8 mb-6 rounded-lg p-6 border ${p?j?"bg-green-900/20 border-green-500/30":"bg-rose-900/20 border-rose-500/30":"bg-blue-900/20 border-blue-500/30"}`,children:[e.jsxs("h4",{className:`font-bold mb-2 flex items-center ${p&&!j?"text-rose-300":"text-green-400"}`,children:[e.jsx(Z,{className:"h-5 w-5 mr-2"})," Explanation"]}),e.jsx("p",{className:`${p&&!j?"text-rose-100":"text-green-200"}`,children:p?j?l.explanation_correct:l.explanation_wrong:l.explanation_correct})]}),e.jsxs("div",{className:"bg-gray-900/30 px-8 py-4 flex justify-between",children:[e.jsxs("button",{onClick:()=>{xe(),b("click")},disabled:R===0,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-lg disabled:opacity-50",children:[e.jsx(ke,{className:"h-4 w-4 inline"})," Previous"]}),e.jsxs("div",{className:"text-gray-400 text-sm",children:["Answered ",g.size," / ",m]}),e.jsxs("button",{onClick:()=>{ue(),b("click")},disabled:!l,className:"px-4 py-2 bg-blue-600 text-white rounded-lg disabled:opacity-50",children:[de?"Finish Question":"Next"," ",e.jsx(Ie,{className:"h-4 w-4 inline"})]})]})]})})]})]})]})]})}export{Xe as default};
