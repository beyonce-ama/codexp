import{K as ve,r as i,j as e,L as I,$ as je}from"./app-BJhQd_PZ.js";import{a as f,A as K,U as ye,T as Z}from"./app-layout-Dle9PyH0.js";import{A as q}from"./AnimatedBackground-D4Tfl3W2.js";import{C as Ne}from"./circle-check-big-CXiULuHG.js";import{X as H,S as V}from"./x-D63ij1Yn.js";import{R as Y}from"./refresh-cw-CxWP3tcZ.js";import{M as we}from"./mail-BX--HgTX.js";import{C as _e}from"./calendar-Cc6puPMk.js";import{S as Se}from"./settings-BWA8Yyd7.js";import{C as ke}from"./chart-column-D9q8zizJ.js";import{Z as Ce}from"./zap-BcfkSNOI.js";import{S as Ae,C}from"./users-BBAKaOU6.js";import{T as G}from"./trophy-_adu0j5O.js";import{A as Pe}from"./activity-C3sx_c67.js";import{A as Me}from"./award-DIpufp3o.js";import{T as J}from"./trending-up-CRhupYZE.js";import"./utils-jAU0Cazi.js";import"./createLucideIcon-BKKyVU85.js";const Q=[{title:"Home",href:"/dashboard"},{title:"My Profile",href:"/profile"}];function Ve(){var O,R,W,F,U,z,B,D;const{auth:v}=ve().props,r=v==null?void 0:v.user,[d,p]=i.useState({username:(r==null?void 0:r.name)||"",avatar_url:null,music_enabled:!0,sound_enabled:!0}),[s,j]=i.useState(null),[ee,A]=i.useState(!0),[g,h]=i.useState(!1),[P,se]=i.useState(!1),[M,$]=i.useState(!1),[x,n]=i.useState(null),ae=["default.png","girl1.png","girl2.png","girl3.png","girl4.png","girl5.png","boy1.png","boy2.png","boy3.png","boy4.png","boy5.png","boy6.png"],[te,u]=i.useState(!1),[b,y]=i.useState(null),N={blue:"bg-blue-900/30 text-blue-400 border-blue-800",green:"bg-green-900/30 text-green-400 border-green-800",yellow:"bg-yellow-900/30 text-yellow-400 border-yellow-800",red:"bg-red-900/30 text-red-400 border-red-800",purple:"bg-purple-900/30 text-purple-400 border-purple-800",indigo:"bg-indigo-900/30 text-indigo-400 border-indigo-800",cyan:"bg-cyan-900/30 text-cyan-400 border-cyan-800"};i.useEffect(()=>{w(),E(!0)},[]);const w=async()=>{try{const t=await f.get("/api/me/profile"),l=(t==null?void 0:t.data)??t,a=(l==null?void 0:l.data)??l,c=(a==null?void 0:a.profile)??a;c!=null&&c.username?p(o=>({...o,username:c.username,avatar_url:c.avatar_url??null,music_enabled:!!(c.music_enabled??o.music_enabled),sound_enabled:!!(c.sound_enabled??o.sound_enabled)})):p(o=>({...o,username:(r==null?void 0:r.name)||""}))}catch{p(t=>({...t,username:(r==null?void 0:r.name)||""}))}},E=async(t=!1)=>{var l;try{t&&A(!0),$(!0);const a=await f.get("/api/me/stats");if(a!=null&&a.success&&a.data)j(a.data);else{const c=((l=a==null?void 0:a.data)==null?void 0:l.data)??(a==null?void 0:a.data)??a;j(c)}}catch(a){console.error("Error fetching /api/me/stats:",a),j({user:{stars:0},totals:{xp:0,stars:0},ai_stats:{ai_attempts:0,ai_successful_attempts:0},solo_stats:{total_attempts:0,successful_attempts:0},duels_played:0,duels_won:0,duels_today:0,live_played:0,live_won:0,matches_played:0,matches_won:0,language_stats:[]})}finally{A(!1),$(!1)}},le=async()=>{var t;try{h(!0),n(null);const l=await f.put("/api/me/profile",d),a=((t=l==null?void 0:l.data)==null?void 0:t.success)??(l==null?void 0:l.success)??(l==null?void 0:l.status)===200;se(!1),n({type:a?"success":"error",text:a?"Profile updated successfully!":"Failed to update profile."}),a&&w()}catch(l){console.error("Error saving profile:",l),n({type:"error",text:"Failed to update profile. Please try again."})}finally{h(!1)}},re=async()=>{var t;if(b)try{h(!0),n(null);const l=`/avatars/${b}`,a=await f.put("/api/me/profile",{...d,avatar_url:l});((t=a==null?void 0:a.data)==null?void 0:t.success)??(a==null?void 0:a.success)??(a==null?void 0:a.status)===200?(u(!1),y(null),n({type:"success",text:"Avatar updated!"}),await w()):n({type:"error",text:"Failed to update avatar."})}catch(l){console.error("Error saving avatar:",l),n({type:"error",text:"Failed to update avatar. Please try again."})}finally{h(!1)}},ce=async()=>{await E(!1),n({type:"success",text:"Stats refreshed!"})};i.useEffect(()=>{if(x){const t=setTimeout(()=>n(null),3e3);return()=>clearTimeout(t)}},[x]);const ie=((O=s==null?void 0:s.totals)==null?void 0:O.xp)??0,ne=((R=s==null?void 0:s.user)==null?void 0:R.stars)??((W=s==null?void 0:s.totals)==null?void 0:W.stars)??0,oe=((F=s==null?void 0:s.solo_stats)==null?void 0:F.total_attempts)??0,de=((U=s==null?void 0:s.solo_stats)==null?void 0:U.successful_attempts)??0,me=((z=s==null?void 0:s.ai_stats)==null?void 0:z.ai_attempts)??0,xe=((B=s==null?void 0:s.ai_stats)==null?void 0:B.ai_successful_attempts)??0,_=oe+me,T=de+xe,ue=_?Math.round(T/_*100):0,pe=(s==null?void 0:s.duels_played)??0,ge=(s==null?void 0:s.duels_won)??0,he=(s==null?void 0:s.live_played)??(s==null?void 0:s.matches_played)??0,be=(s==null?void 0:s.live_won)??(s==null?void 0:s.matches_won)??0,S=pe+he,L=ge+be,fe=S?Math.round(L/S*100):0,m=({title:t,value:l,icon:a,color:c,suffix:o="",trend:k,description:X})=>e.jsx("div",{className:`rounded-lg shadow-lg p-6 border hover:border-gray-500 transition-all backdrop-blur-sm ${N[c]}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-3 rounded-lg bg-black/10",children:e.jsx(a,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium opacity-80",children:t}),e.jsxs("p",{className:"text-2xl font-bold",children:[l,o]}),X&&e.jsx("p",{className:"text-xs opacity-70 mt-1",children:X})]})]}),k&&e.jsx("div",{className:`text-sm font-medium ${k==="up"?"text-green-400":k==="down"?"text-red-400":"text-gray-400"}`,children:e.jsx(J,{className:"h-4 w-4"})})]})});return ee?e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx(q,{}),e.jsxs(K,{breadcrumbs:Q,children:[e.jsx(I,{title:"My Profile"}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-gray-800/50 rounded-lg shadow-lg p-6 border border-gray-700 backdrop-blur-sm",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-700/50 rounded w-1/4 mb-6"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Array.from({length:4}).map((t,l)=>e.jsx("div",{className:"h-32 bg-gray-700/50 rounded-lg backdrop-blur-sm"},l))})]})})})]})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx(q,{}),e.jsxs(K,{breadcrumbs:Q,children:[e.jsx(I,{title:"My Profile"}),e.jsxs("div",{className:"relative z-10 flex h-full flex-1 flex-col gap-6 p-6",children:[x&&e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg border ${x.type==="success"?"bg-green-900/50 border-green-700 text-green-300":"bg-red-900/50 border-red-700 text-red-300"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[x.type==="success"?e.jsx(Ne,{className:"h-5 w-5"}):e.jsx(H,{className:"h-5 w-5"}),e.jsx("span",{children:x.text})]}),e.jsx("button",{onClick:()=>n(null),className:"text-gray-400 hover:text-white",children:e.jsx(H,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg backdrop-blur-sm",children:e.jsx(ye,{className:"h-8 w-8 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"MY PROFILE"}),e.jsx("p",{className:"text-gray-400",children:"Manage your account and view your progress"})]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:ce,disabled:M,className:"flex items-center space-x-2 px-4 py-2 bg-gray-800/50 border border-gray-700 rounded-lg hover:bg-gray-700/50 disabled:opacity-50 transition-colors backdrop-blur-sm",children:[e.jsx(Y,{className:`h-4 w-4 ${M?"animate-spin":""}`}),e.jsx("span",{children:"Refresh"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx("div",{className:"bg-gray-800/60 rounded-2xl shadow-xl p-8 border border-gray-700/70 hover:border-gray-600 transition-all backdrop-blur-md",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-28 w-28 rounded-full p-[3px] bg-gradient-to-tr from-purple-500 via-pink-500 to-blue-500 shadow-lg mx-auto",children:e.jsx("img",{src:d.avatar_url||"/avatars/default.png",alt:"Avatar",className:"h-full w-full rounded-full object-cover border-4 border-gray-900"})}),e.jsx("button",{className:"absolute bottom-2 right-2 p-2 bg-blue-600 rounded-full shadow-lg hover:bg-blue-700 border-2 border-gray-900",onClick:()=>{y(null),u(!0)},title:"Change Avatar",children:e.jsx(Y,{className:"h-4 w-4 text-white"})})]}),e.jsx("h3",{className:"mt-4 text-2xl font-extrabold text-white",children:d.username||(r==null?void 0:r.name)}),e.jsxs("p",{className:"text-gray-400 flex items-center mt-1 text-sm",children:[e.jsx(we,{className:"h-4 w-4 mr-1"}),r==null?void 0:r.email]}),e.jsxs("div",{className:"w-full mt-6 text-left",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Username"}),P?e.jsx("input",{type:"text",value:d.username,onChange:t=>p({...d,username:t.target.value}),className:"w-full px-3 py-2 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-white backdrop-blur-sm",placeholder:"Enter username"}):e.jsx("p",{className:"text-white py-2 px-3 bg-gray-700/40 rounded-lg backdrop-blur-sm",children:d.username||"Not set"})]}),e.jsx("div",{className:"mt-5 w-full space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 bg-gray-700/40 rounded-lg backdrop-blur-sm",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Member Since"}),e.jsxs("span",{className:"text-sm text-gray-400 flex items-center",children:[e.jsx(_e,{className:"h-4 w-4 mr-1"}),r!=null&&r.created_at?new Date(r.created_at).toLocaleDateString():"â€”"]})]})}),e.jsxs(je,{href:"/settings",className:"mt-6 inline-flex items-center gap-2 px-5 py-2 rounded-xl bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold shadow-md transition",children:[e.jsx(Se,{className:"h-5 w-5"}),"Settings"]}),P&&e.jsx("button",{onClick:le,disabled:g,className:"w-full mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white disabled:opacity-50",children:g?"Savingâ€¦":"Save Changes"})]})})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ke,{className:"h-5 w-5 text-cyan-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Performance Overview"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(m,{title:"Total XP",value:ie,icon:Ce,color:"yellow",trend:"up",description:"Experience points earned"}),e.jsx(m,{title:"Stars Earned",value:ne,icon:Ae,color:"purple",trend:"neutral",description:"Achievement stars"}),e.jsx(m,{title:"Total Attempts",value:_,icon:Z,color:"blue",trend:"up",description:"Solo + AI"}),e.jsx(m,{title:"Overall Success",value:ue,icon:G,color:"green",suffix:"%",trend:"up",description:`${T} successful attempts`})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(V,{className:"h-5 w-5 text-red-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Duel Performance"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(m,{title:"Matches Played",value:S,icon:Pe,color:"red",description:"Classic + Live"}),e.jsx(m,{title:"Matches Won",value:L,icon:Me,color:"indigo",description:"All PvP victories"}),e.jsx(m,{title:"Win Rate",value:fe,icon:J,color:"cyan",suffix:"%",description:"Overall PvP success"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(C,{className:"h-5 w-5 text-green-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Language Progress"})]}),e.jsx("div",{className:"bg-gray-800/50 rounded-lg shadow-lg p-6 border border-gray-700 backdrop-blur-sm",children:(D=s==null?void 0:s.language_stats)!=null&&D.length?e.jsx("div",{className:"space-y-4",children:s.language_stats.map((t,l)=>{const a=Object.keys(N),c=a[l%a.length],o=Math.max(0,Math.min(100,Math.round(t.winrate)));return e.jsx("div",{className:`rounded-lg shadow-lg p-4 border hover:border-gray-500 transition-all backdrop-blur-sm ${N[c]}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-black/10",children:e.jsx(C,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg capitalize",children:t.language}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm opacity-80",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),t.solo_completed," solo"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),t.games_played," duels"]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),t.wins," wins"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:[o,"%"]}),e.jsx("p",{className:"text-sm opacity-80",children:"win rate"}),e.jsx("div",{className:"mt-2 w-24 h-2 bg-gray-600/40 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 rounded-full",style:{width:`${o}%`,background:"currentColor"}})})]})]})},`${t.language}-${l}`)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"p-4 bg-gray-700/50 rounded-full w-fit mx-auto mb-4 backdrop-blur-sm",children:e.jsx(C,{className:"h-12 w-12 text-gray-500"})}),e.jsx("p",{className:"text-gray-400 text-lg mb-2",children:"No language statistics yet"}),e.jsx("p",{className:"text-gray-500",children:"Complete challenges to see your progress"})]})})]})]})})]}),te&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>u(!1)}),e.jsxs("div",{className:"relative z-10 w-full max-w-3xl rounded-2xl bg-gray-900 text-gray-100 border border-gray-700 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select an Avatar"}),e.jsx("button",{className:"text-gray-400 hover:text-white",onClick:()=>u(!1),title:"Close",children:"âœ•"})]}),e.jsxs("div",{className:"p-5",children:[e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-4",children:ae.map(t=>{const l=b===t;return e.jsx("button",{type:"button",onClick:()=>y(t),className:`rounded-xl p-1 border transition
                            ${l?"border-blue-500 ring-2 ring-blue-400":"border-gray-700 hover:border-gray-500"}`,title:t.replace(".png","").replace("_"," "),children:e.jsx("img",{src:`/avatars/${t}`,alt:t,className:"w-full aspect-square rounded-lg object-cover"})},t)})}),e.jsxs("div",{className:"mt-6 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600",onClick:()=>u(!1),children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 disabled:opacity-50",disabled:!b||g,onClick:re,children:g?"Savingâ€¦":"Save Avatar"})]})]})]})]})]})]})]})}export{Ve as default};
