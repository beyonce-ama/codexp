import{K as Z,r as i,j as e,L as ee}from"./app-C8jc3Zxd.js";import{a as j,A as se,C as $}from"./app-layout-CnTIZLAL.js";import{A as te}from"./AnimatedBackground-3yVlqYwr.js";import{S as A,a as F,X as b}from"./x-q1XFNyja.js";import{C as I}from"./code-xml-CMEcdxEK.js";import{S as ae}from"./shield-check-wbJXR09c.js";import{U as ie}from"./users-BED5Vxjq.js";import{L as P}from"./loader-circle-DwBneBUU.js";import{c as O}from"./createLucideIcon-BixK-Jvu.js";import{Z as ne}from"./zap-DNr75zQN.js";import{T as le}from"./trophy-CF1jIGYY.js";import{M as re}from"./medal-DyAYcvqr.js";import"./utils-jAU0Cazi.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],R=O("CircleCheck",ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],k=O("History",de),oe={python:"Python",java:"Java",cpp:"C++"},q=r=>oe[r]??r.toUpperCase(),me=[{title:"Home",href:"/dashboard"},{title:"Play",href:"#"},{title:"1v1 Matchmaking",href:"/play/matchmaking"}],xe=[{value:"python",label:"Python"},{value:"java",label:"Java"},{value:"cpp",label:"C++"}],he=[{value:"easy",label:"Easy",hint:"Warm-up tasks"},{value:"medium",label:"Medium",hint:"Trickier logic"},{value:"hard",label:"Hard",hint:"Deep problem-solving"}],ue=r=>{if(!r&&r!==0)return"—";const c=Math.floor(r/60),n=r%60;return c?`${c}m ${n}s`:`${n}s`},Me=()=>{var H;const{props:r}=Z(),c=(H=r==null?void 0:r.auth)==null?void 0:H.user,[n,Q]=i.useState("python"),[d,U]=i.useState("easy"),[o,y]=i.useState(!1),[B,x]=i.useState(1),[N,m]=i.useState(null),[v,h]=i.useState(null),[D,w]=i.useState(0),[G,J]=i.useState(!1),u=i.useMemo(()=>`presence-queue.${n}.${d}`,[n,d]),[W,p]=i.useState(!1),[X,z]=i.useState(!1),[S,K]=i.useState([]),[M,L]=i.useState(null),g=(s,t)=>{const l=t?`/play/m/${s}?t=${encodeURIComponent(t)}`:`/play/m/${s}`;window.location.href=l};i.useEffect(()=>{if(!o)return;w(0);const s=setInterval(()=>{w(t=>t>=120?(clearInterval(s),h("⏳ Seems like no one is online right now. Try again later!"),E(),t):t+1)},1e3);return()=>clearInterval(s)},[o]);const E=async()=>{var s;h(null);try{await j.post("/api/matchmaking/cancel")}catch{}finally{y(!1),J(!1),m(null),x(1),w(0);try{(s=window.Echo)==null||s.leave(u)}catch{}}};async function f(s,t){const l=t?await j.post(s,t):await j.post(s);return l&&typeof l=="object"&&"data"in l?l.data:l}const _=async()=>{var s,t,l;L(null),z(!0);try{const a=await j.get("/api/matchmaking/history",{params:{limit:20}}),Y=((s=a==null?void 0:a.data)==null?void 0:s.items)??(a==null?void 0:a.items)??[];K(Y)}catch(a){L(((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to load history.")}finally{z(!1)}},T=async()=>{p(!0),await _()};i.useEffect(()=>{if(!o)return;const s=window.Echo;if(s)return s.join(u).here(t=>x(t.length)).joining(()=>x(t=>t+1)).leaving(()=>x(t=>Math.max(1,t-1))).listen("MatchFound",async()=>{try{const t=await f("/api/matchmaking/poll",{language:n,difficulty:d});"slug"in t&&t.slug&&g(t.slug,t.token)}catch{}}),s.private(`user.${c.id}`).listen("MatchFound",async()=>{try{const t=await f("/api/matchmaking/poll",{language:n,difficulty:d});"slug"in t&&t.slug&&g(t.slug,t.token)}catch{}}),()=>{try{window.Echo.leave(u)}catch{}try{window.Echo.leave(`user.${c.id}`)}catch{}}},[o,u,c==null?void 0:c.id,n,d]);const V=async()=>{var s,t,l;h(null),y(!0),m(null);try{const a=await f("/api/matchmaking/join",{language:n,difficulty:d,resume:!1});if("slug"in a&&a.slug){g(a.slug,a.token);return}"queued"in a&&a.queued||"paired"in a&&a.paired?m(String(c.id)):"ticket_id"in a&&a.ticket_id&&m(String(a.ticket_id))}catch(a){console.error("[JOIN ERROR]",((s=a==null?void 0:a.response)==null?void 0:s.data)||a),h(((l=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to join matchmaking."),y(!1)}};return i.useEffect(()=>{if(!o)return;let s=!1;const t=async()=>{try{const a=await f("/api/matchmaking/poll",{language:n,difficulty:d});if(!s&&"slug"in a&&a.slug){g(a.slug,a.token);return}}catch{}s||setTimeout(t,1200)},l=setTimeout(t,800);return()=>{s=!0,clearTimeout(l)}},[o,n,d]),e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 -z-10",children:e.jsx(te,{})}),e.jsxs(se,{breadcrumbs:me,children:[e.jsx(ee,{title:"1v1 Matchmaking"}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-7 h-7 text-indigo-400"}),e.jsx(I,{className:"w-5 h-5 text-cyan-400"}),e.jsx(F,{className:"w-6 h-6 text-emerald-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-400 via-fuchsia-400 to-cyan-400 bg-clip-text text-transparent",children:"1V1 MATCHMAKING"}),e.jsx("p",{className:"text-zinc-400 text-sm",children:"Queue by language & difficulty and get paired instantly."})]})]})}),e.jsxs("div",{className:"rounded-2xl border border-slate-700/60 bg-slate-900/40 shadow-xl",children:[e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"text-sm text-zinc-400",children:"Language"}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:xe.map(s=>{const t=n===s.value;return e.jsxs("button",{onClick:()=>Q(s.value),disabled:o,className:["flex items-center justify-center gap-2 px-4 py-3 rounded-xl border transition",t?"border-indigo-500/60 bg-indigo-500/10":"border-slate-700/60 hover:border-slate-600"].join(" "),"aria-pressed":t,children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:s.label})]},s.value)})})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"text-sm text-zinc-400",children:"Difficulty"}),e.jsx("div",{className:"mt-2 grid grid-cols-3 gap-2",children:he.map(s=>{const t=d===s.value;return e.jsx("button",{onClick:()=>U(s.value),disabled:o,className:["px-3 py-3 rounded-xl border text-sm transition",t?"border-emerald-500/60 bg-emerald-500/10":"border-slate-700/60 hover:border-slate-600"].join(" "),"aria-pressed":t,title:s.hint,children:s.label},s.value)})})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsxs("label",{className:"text-sm text-zinc-400 flex items-center gap-2",children:["Mode",e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-zinc-500",children:[e.jsx(ae,{className:"w-3 h-3"})," Token-safe"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"w-full px-4 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"AI-Generated"})]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-slate-800 text-zinc-400",children:"Same prompt for both"})]}),e.jsx("p",{className:"mt-2 text-xs text-zinc-500",children:"A single challenge is generated & frozen server-side so both players get the exact same text & tests."})]})]})]}),e.jsx("div",{className:"border-t border-slate-700/60"}),e.jsxs("div",{className:"p-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(ie,{className:"w-4 h-4 text-zinc-400"}),e.jsxs("span",{className:"text-zinc-400",children:["Players waiting in ",e.jsx("span",{className:"font-medium text-zinc-200",children:q(n)})," /",e.jsxs("span",{className:"font-medium text-zinc-200",children:[" ",d]}),":"]}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-lg bg-slate-800 text-zinc-100",children:B})]}),e.jsx("div",{className:"flex items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 text-zinc-200",children:G?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 text-emerald-400"}),"Match found! Preparing challenge…"]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 animate-spin"}),"Searching… ",e.jsxs("span",{className:"ml-2 text-xs text-zinc-400",children:[D,"s"]})]})}),e.jsxs("button",{onClick:E,className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-zinc-200",children:[e.jsx(b,{className:"w-4 h-4"})," Cancel"]}),e.jsxs("button",{onClick:T,className:"inline-flex items-center gap-2 px-3 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 hover:bg-slate-800 transition text-zinc-200",type:"button",children:[e.jsx(k,{className:"w-4 h-4"})," History"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:V,className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl bg-gradient-to-r from-cyan-500 to-indigo-600 hover:opacity-95 active:opacity-100 transition text-white font-medium",children:[e.jsx(A,{className:"w-4 h-4"})," Find Match"]}),e.jsxs("button",{onClick:T,className:"inline-flex items-center gap-2 px-3 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 hover:bg-slate-800 transition text-zinc-200",type:"button",children:[e.jsx(k,{className:"w-4 h-4"})," History"]})]})})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(C,{icon:e.jsx($,{className:"w-4 h-4"}),title:"Speed wins",text:"Winner is the first to submit a correct solution. Ties decided by time to correct."}),e.jsx(C,{icon:e.jsx(ne,{className:"w-4 h-4"}),title:"No code mirroring",text:"You only see your own editor. Opponent panel shows status/animations only."}),e.jsx(C,{icon:e.jsx(le,{className:"w-4 h-4"}),title:"XP rules",text:"Base XP by difficulty; minus 0.5 if you used a hint (server-enforced)."})]}),(v||N)&&e.jsxs("div",{className:"mt-6 flex flex-col gap-2",children:[v&&e.jsxs("div",{className:"flex items-center gap-2 text-red-300 bg-red-900/20 border border-red-900/40 px-3 py-2 rounded-lg",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:v})]}),N&&e.jsxs("div",{className:"flex items-center gap-2 text-emerald-300 bg-emerald-900/20 border border-emerald-900/40 px-3 py-2 rounded-lg",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:["Queued (ticket #",N,"). You’ll auto-join when a match is found."]})]})]})]}),W&&e.jsxs("div",{className:"fixed inset-0 z-[999] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>p(!1)}),e.jsxs("div",{className:"relative w-full max-w-3xl mx-4 rounded-2xl border border-slate-700/60 bg-slate-900/90 backdrop-blur p-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-indigo-400"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Recent 1v1 History"})]}),e.jsx("button",{onClick:()=>p(!1),className:"p-2 rounded-lg hover:bg-slate-800","aria-label":"Close",children:e.jsx(b,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"mt-3 px-2",children:X?e.jsxs("div",{className:"flex items-center gap-2 text-zinc-400",children:[e.jsx(P,{className:"w-4 h-4 animate-spin"})," Loading…"]}):M?e.jsx("div",{className:"text-red-300 bg-red-900/20 border border-red-900/40 px-3 py-2 rounded-lg",children:M}):S.length===0?e.jsx("div",{className:"text-zinc-400",children:"No recent matches yet."}):e.jsx("ul",{className:"divide-y divide-slate-700/50",children:S.map(s=>{var t;return e.jsxs("li",{className:"py-3 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.is_winner?e.jsxs("span",{className:"inline-flex items-center gap-1 text-emerald-300",children:[e.jsx(re,{className:"w-4 h-4"})," Win"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-red-300",children:[e.jsx(b,{className:"w-4 h-4"})," Loss"]}),e.jsxs("span",{className:"text-zinc-300",children:["vs ",e.jsx("span",{className:"font-medium",children:(t=s.opponent)==null?void 0:t.name})]})]}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-zinc-500",children:[e.jsx("span",{className:"px-2 py-0.5 rounded bg-slate-800 border border-slate-700/60",children:q(s.language||"")}),s.difficulty&&e.jsx("span",{className:"px-2 py-0.5 rounded bg-slate-800 border border-slate-700/60 capitalize",children:s.difficulty}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"})," ",ue(s.time_spent_sec)]}),s.finished_at&&e.jsx("span",{children:new Date(s.finished_at).toLocaleString()})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:s.match_public_id&&e.jsx("a",{href:`/play/m/${s.match_public_id}`,className:"text-xs px-3 py-1 rounded-lg border border-slate-700/60 hover:bg-slate-800 text-zinc-200",children:"View"})})]},s.id)})})}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2 px-2",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-3 py-2 rounded-lg border border-slate-700/60 hover:bg-slate-800 text-zinc-200",children:"Close"}),e.jsx("button",{onClick:_,className:"px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-zinc-100",children:"Refresh"})]})]})]})]})]})},C=({icon:r,title:c,text:n})=>e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-zinc-300",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-lg bg-slate-800",children:r}),e.jsx("span",{className:"text-sm font-medium",children:c})]}),e.jsx("p",{className:"mt-2 text-xs text-zinc-500",children:n})]});export{Me as default};
