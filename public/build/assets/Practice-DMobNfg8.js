import{K as we,r as i,j as e,L as ee}from"./app-BuA-55oW.js";import{b as F,S as re,A as te}from"./app-layout-DRXPkxUD.js";import{A as je}from"./AnimatedBackground-DokRUgip.js";import{R as Ne}from"./refresh-cw-DQgQF5oz.js";import{B as ve,X as Se}from"./x-im8-Hde4.js";import{C as se}from"./users-BCSDvDZo.js";import{L as ae}from"./lightbulb-BF5alcdW.js";import{F as Ce}from"./filter-D5EBXrvj.js";import{S as ke}from"./search-BYKKEDy1.js";import{C as Ie}from"./chart-column-DGVDcByn.js";import{E as Ee}from"./eye-off-qUssCq_u.js";import{E as Re}from"./eye-BBfdOY4D.js";import{C as Ae}from"./circle-check-big-CG3ZLgQj.js";import{A as Te}from"./arrow-left-hP6QvODf.js";import{A as _e}from"./arrow-right-DPqSTFBp.js";import"./utils-jAU0Cazi.js";import"./createLucideIcon-w0d7Yc2W.js";const ne=[{title:"Home",href:"/dashboard"},{title:"Practice",href:"#"},{title:"Review Mode",href:"/play/practice"}],O=["python","java","cpp"],M=re.mixin({buttonsStyling:!1,background:"#0f172a",color:"#e5e7eb",iconColor:"#22d3ee",customClass:{popup:"bg-slate-900 text-slate-200 border border-slate-700 rounded-2xl shadow-2xl",title:"text-slate-100 font-semibold text-xl",htmlContainer:"text-slate-300 leading-relaxed",confirmButton:"px-4 py-2 rounded-lg bg-violet-600 hover:bg-violet-700 text-white font-medium shadow",cancelButton:"px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-100 font-medium ml-2",denyButton:"px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-100 font-medium ml-2"}}),L=(A,p=2500)=>re.fire({toast:!0,position:"top-end",showConfirmButton:!1,timer:p,timerProgressBar:!0,background:"transparent",customClass:{popup:"!p-0 !bg-transparent !shadow-none !border-0",timerProgressBar:"bg-yellow-500/50"},html:`
      <div class="flex items-center gap-3 rounded-xl border border-yellow-700 bg-slate-900/90 backdrop-blur px-4 py-3 shadow-2xl">
        <div class="p-2 rounded-lg border border-yellow-700 bg-yellow-500/10">
          <!-- Info icon -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8"  x2="12" y2="8"></line>
          </svg>
        </div>
        <p class="text-sm text-white font-semibold">${A}</p>
      </div>
    `});function He(){var H,V;const{auth:A}=we().props;A==null||A.user;const[p,z]=i.useState([]),[C,ie]=i.useState([]),[k,b]=i.useState(0),[G,D]=i.useState(null),[w,K]=i.useState(!1),[_,q]=i.useState(!1),[I,W]=i.useState("python"),[u,$]=i.useState("all"),[P,U]=i.useState(""),[le,X]=i.useState(!0),[oe,ce]=i.useState([]),[h,B]=i.useState(new Set),[g,de]=i.useState(0),E=i.useRef(null),J=i.useRef(null),j=i.useRef(null),[ue,Y]=i.useState(null),Q=((H=document.querySelector('meta[name="csrf-token"]'))==null?void 0:H.content)||((V=window.Laravel)==null?void 0:V.csrfToken)||"",xe=async t=>{if(!(!t||!j.current))try{await fetch("/practice/position",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":Q},body:JSON.stringify({question_set_id:j.current.id,last_question_id:t})})}catch{}},[me,Le]=i.useState(!0);i.useRef(null);const v=t=>{if(me)try{F.play(t)}catch{}};i.useEffect(()=>{R()},[I]),i.useEffect(()=>{he(),N()},[p,u,P,h]),i.useEffect(()=>{var n;const t=((n=C[k])==null?void 0:n.id)??null;t&&(E.current=t,xe(t))},[k,C]),i.useEffect(()=>{if(j.current&&g>0&&h.size>=g){const{id:t,set_index:n,language:s}=j.current;fetch("/practice/finish",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":Q},body:JSON.stringify({question_set_id:t})}).catch(()=>{}).finally(async()=>{try{const a=await(await fetch(`/practice/sets?language=${s}`,{credentials:"same-origin"})).json(),d=(Array.isArray(a==null?void 0:a.sets)?a.sets:[]).find(r=>r.set_index>n);if(d){try{F.play("success")}catch{}(await M.fire({icon:"success",title:"ðŸŽ‰ Congratulations!",html:`<div class="text-left">
                  <p>Youâ€™ve finished <b>Set #${n}</b> (${s}).</p>
                  <p class="mt-2">The next set <b>#${d.set_index}</b> is available. Ready to continue?</p>
                </div>`,confirmButtonText:`Start Set #${d.set_index}`,showCancelButton:!0,cancelButtonText:"Later"})).isConfirmed&&R()}else{try{F.play("success")}catch{}await M.fire({icon:"success",title:"ðŸŽ‰ Great job!",html:`<div class="text-left">
                  <p>Youâ€™ve finished <b>Set #${n}</b> (${s}).</p>
                  <p class="mt-2">No next set is uploaded yet. <b>Stay tuned</b> for more questions!</p>
                </div>`,confirmButtonText:"Okay"})}}catch{R()}})}},[h,g]);const R=async()=>{var n;const t=new AbortController;try{X(!0);const s=await fetch(`/practice/current?language=${I}`,{signal:t.signal,credentials:"same-origin"});if(!s.ok)throw s.status===404?{code:"NO_SET"}:s.status===401||s.status===419?{code:"SESSION"}:{code:"GENERIC"};const x=await s.json(),{set:a,progress:c}=x;j.current={id:a.id,filename:a.filename,total_questions:a.total_questions,set_index:a.set_index,language:a.language},de(a.total_questions||0),E.current=(c==null?void 0:c.last_question_id)??null;const d=await fetch(`/data/${a.filename}`,{signal:t.signal,credentials:"same-origin"});if(!d.ok)throw d.status===404?{code:"FILE_MISSING",filename:a.filename,setIndex:a.set_index,lang:a.language}:{code:"GENERIC"};const r=await d.json();z(r),ce([...new Set(r.map(m=>m.category))]);const l=new Set(r.map(m=>m.id));if(l.size!==r.length){const m=new Set,T=[];r.forEach(f=>{m.has(f.id)?T.push(f.id):m.add(f.id)}),console.warn("[Practice] Duplicate or missing IDs detected",{file:(n=j.current)==null?void 0:n.filename,totalRows:r.length,uniqueIds:l.size,duplicates:Array.from(new Set(T))})}const y=Array.isArray(c==null?void 0:c.taken_ids)?c.taken_ids:[];B(new Set(y)),N()}catch(s){if((s==null?void 0:s.name)==="AbortError")return;console.error("Error loading questions:",s),z([]);const x=((s==null?void 0:s.code)??"GENERIC")+":"+((s==null?void 0:s.setIndex)??"")+":"+((s==null?void 0:s.lang)??""),a=J.current===x;a||(J.current=x);const c=O.indexOf(I),d=O[(c+1)%O.length];let r="Canâ€™t load questions",l="We ran into a hiccup loading this practice set. Please try again.",y="Retry",m=!1,T="",f=()=>R();switch(s==null?void 0:s.code){case"NO_SET":r="Practice set coming soon",l=`Weâ€™re preparing the next <b>${I}</b> question set. Check back soon!`,y="Got it",f=null,m=!0,T=`Try ${d.toUpperCase()}`;break;case"FILE_MISSING":r="Updating questions",l=`Weâ€™re updating <b>Set #${s.setIndex}</b> (${s.lang}). Please try again a little later.`,y="Retry",f=()=>R();break;case"SESSION":r="Session expired",l="Please refresh the page and sign in again.",y="Refresh",f=()=>window.location.reload();break;default:r="Canâ€™t load questions",l="Looks like a network hiccup. Please try again.",y="Retry",f=()=>R();break}if(a)L((s==null?void 0:s.code)==="FILE_MISSING"?"Still updating â€” please check back later.":"Still canâ€™t load â€” try again soon.");else{const Z=await M.fire({icon:"info",title:r,html:l,confirmButtonText:y,showDenyButton:m,denyButtonText:T});Z.isConfirmed&&f&&await f(),Z.isDenied&&W(d)}}finally{X(!1)}},he=()=>{const t=P.trim().toLowerCase();let n=p.filter(s=>!h.has(s.id));if(u!=="all"&&(n=n.filter(s=>s.category===u)),t&&(n=n.filter(s=>s.question.toLowerCase().includes(t)||s.category.toLowerCase().includes(t))),ie(n),n.length===0){const s=new Map;for(const a of p)h.has(a.id)||s.set(a.category,(s.get(a.category)??0)+1);if(Array.from(s.values()).reduce((a,c)=>a+c,0)>0){if(u!=="all"){const a=Array.from(new Set(p.map(l=>l.category))).sort(),c=Math.max(0,a.indexOf(u)),r=[...a.slice(c+1),...a.slice(0,c)].find(l=>(s.get(l)??0)>0);if(r){L(`Finished "${u}". Switching to "${r}".`),$(r),b(0),N();return}L(`Finished "${u}". Showing remaining questions.`),$("all"),b(0),N();return}if(u==="all"&&t){L("No matches for this search. Clearing search to continue."),U(""),b(0),N();return}}b(0);return}if(E.current!=null){const s=E.current;let x=null;const a={};p.forEach((r,l)=>a[r.id]=l);const c=a[s]??-1;for(let r=c+1;r<p.length;r++){const l=p[r],y=u==="all"||l.category===u,m=!t||l.question.toLowerCase().includes(t)||l.category.toLowerCase().includes(t);if(!h.has(l.id)&&y&&m){x=l.id;break}}x==null&&(x=n[0].id);const d=n.findIndex(r=>r.id===x);b(d>=0?d:0),E.current=null}else b(s=>Math.min(s,Math.max(0,n.length-1)))},N=()=>{D(null),K(!1),q(!1),Y(null)},o=C[k],S=w&&o&&ue===o.id&&G===o.answer,ge=C.length===1||k===C.length-1,fe=async()=>{if(o&&j.current){B(t=>{const n=new Set(t);return n.add(o.id),n});try{await fetch("/practice/taken",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":Q},body:JSON.stringify({question_set_id:j.current.id,question_id:o.id})}),E.current=o.id}catch(t){console.error("Failed to mark taken",t)}}N()},pe=()=>{k>0&&(b(t=>t-1),N())},ye=()=>q(t=>!t),be=t=>{w||!o||(v("click"),D(t),K(!0),q(!0),Y(o.id),t===o.answer?v("success"):v("failure"))};return le?e.jsxs(te,{breadcrumbs:ne,children:[e.jsx(ee,{title:"Practice Review"}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ne,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-blue-400"}),e.jsx("div",{className:"text-gray-300",children:"Loading questions..."})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx(je,{}),e.jsxs(te,{breadcrumbs:ne,children:[e.jsx(ee,{title:"Practice Review"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4 relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ve,{className:"h-8 w-8 text-blue-400"}),e.jsx(se,{className:"h-6 w-6 text-purple-400"}),e.jsx(ae,{className:"h-8 w-8 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"PRACTICE REVIEW"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Review programming questions and learn from explanations"})]})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"lg:w-1/3 flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ce,{className:"h-5 w-5 text-purple-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Question Filters"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Language"}),e.jsxs("select",{value:I,onChange:t=>W(t.target.value),className:"w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200",children:[e.jsx("option",{value:"python",children:"Python"}),e.jsx("option",{value:"java",children:"Java"}),e.jsx("option",{value:"cpp",children:"C++"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Category"}),e.jsxs("select",{value:u,onChange:t=>$(t.target.value),className:"w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200",children:[e.jsx("option",{value:"all",children:"All Categories"}),oe.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search...",value:P,onChange:t=>U(t.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200 placeholder-gray-400"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(Ie,{className:"h-5 w-5 text-green-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Session Stats"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Total Questions:"}),e.jsx("span",{className:"text-blue-300 font-medium",children:g})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Current Progress:"}),e.jsxs("span",{className:"text-purple-300 font-medium",children:[h.size,"/",g]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Language:"}),e.jsx("span",{className:"text-green-300 font-medium capitalize",children:I})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Category:"}),e.jsx("span",{className:"text-yellow-300 font-medium",children:u==="all"?"All":u})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[e.jsx("span",{children:"Completion"}),e.jsxs("span",{children:[g>0?Math.round(h.size/g*100):0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${g>0?Math.round(h.size/g*100):0}%`}})})]})]})]}),e.jsx("div",{className:"lg:w-2/3",children:C.length===0?e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-12 text-center",children:[e.jsx(se,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl text-gray-300 mb-2",children:"No Questions Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"You may have completed all questions for this set/filter."}),e.jsx("button",{onClick:()=>{B(new Set),b(0),N()},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:"Revisit Questions in This Set"})]}):o&&e.jsxs("div",{className:"bg-gray-900/60 rounded-xl shadow-lg overflow-hidden border border-gray-700",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 flex items-center justify-between",children:[e.jsx("div",{className:"bg-white/20 px-3 py-1 rounded-full text-white text-sm font-medium shadow-md",children:o.category}),e.jsxs("button",{onClick:()=>{ye(),v("hover")},className:"flex items-center space-x-2 px-4 py-2 bg-white/10 hover:bg-white/20 text-white font-medium rounded-lg shadow transition",children:[_?e.jsx(Ee,{className:"h-4 w-4"}):e.jsx(Re,{className:"h-4 w-4"}),e.jsx("span",{children:_?"Hide Answer":"Show Answer"})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsx("div",{className:"mb-6 p-4 bg-gray-800/40 border border-gray-700 rounded-lg",children:e.jsx("p",{className:"text-xl text-white font-semibold leading-relaxed whitespace-pre-line",children:o.question.split(/(`[^`]+`)/g).map((t,n)=>t.startsWith("`")?e.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded text-purple-300 font-mono text-base",children:t.replace(/`/g,"")},n):t)})}),w&&e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold ${S?"bg-green-900/40 text-green-200":"bg-rose-900/40 text-rose-200"}`,children:[S?e.jsx(Ae,{className:"h-4 w-4"}):e.jsx(Se,{className:"h-4 w-4"}),S?"Correct":"Incorrect"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-6",children:o.choices.map((t,n)=>{const s=t===o.answer,x=t===G;let a="p-4 rounded-lg border cursor-pointer transition-all ";return _?s?a+="bg-green-900/50 border-green-400 text-green-100":w&&x&&!s?a+="bg-rose-900/50 border-rose-400 text-rose-100":a+="bg-gray-900/20 border-gray-700 text-gray-400":a+="bg-gray-900/30 border-gray-600 text-gray-300 hover:border-gray-400",e.jsx("div",{className:a,onClick:()=>be(t),onMouseEnter:()=>v("hover"),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full border flex items-center justify-center",children:String.fromCharCode(65+n)}),e.jsx("span",{className:"font-mono",children:t})]})},n)})})]}),_&&e.jsxs("div",{className:`mx-8 mb-6 rounded-lg p-6 border ${w?S?"bg-green-900/20 border-green-500/30":"bg-rose-900/20 border-rose-500/30":"bg-blue-900/20 border-blue-500/30"}`,children:[e.jsxs("h4",{className:`font-bold mb-2 flex items-center ${w&&!S?"text-rose-300":"text-green-400"}`,children:[e.jsx(ae,{className:"h-5 w-5 mr-2"})," Explanation"]}),e.jsx("p",{className:`${w&&!S?"text-rose-100":"text-green-200"}`,children:w?S?o.explanation_correct:o.explanation_wrong:o.explanation_correct})]}),e.jsxs("div",{className:"bg-gray-900/30 px-8 py-4 flex justify-between",children:[e.jsxs("button",{onClick:()=>{pe(),v("click")},disabled:k===0,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-lg disabled:opacity-50",children:[e.jsx(Te,{className:"h-4 w-4 inline"})," Previous"]}),e.jsxs("div",{className:"text-gray-400 text-sm",children:["Answered ",h.size," / ",g]}),e.jsxs("button",{onClick:()=>{fe(),v("click")},disabled:!o,className:"px-4 py-2 bg-blue-600 text-white rounded-lg disabled:opacity-50",children:[ge?"Finish Question":"Next"," ",e.jsx(_e,{className:"h-4 w-4 inline"})]})]})]})})]})]})]})]})}export{He as default};
