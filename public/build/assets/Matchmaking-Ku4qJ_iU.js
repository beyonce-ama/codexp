import{K as L,r,j as e,L as I}from"./app-GtahOJEu.js";import{A as $,C as q,a as b}from"./app-layout-BGU5i8aK.js";import{A as F}from"./AnimatedBackground-CN_pJb0B.js";import{S as w,a as k,X as C}from"./x-CgTaxSWY.js";import{C as z}from"./code-xml-BnC095Pn.js";import{S as P}from"./shield-check-OPaQNbRT.js";import{U as Q}from"./users-DwpEitiw.js";import{L as R}from"./loader-circle-BOZZkYrd.js";import{Z as _}from"./zap-CcCAyFdu.js";import{T as O}from"./trophy-x_z2y0vW.js";import{c as X}from"./createLucideIcon-B9xt4YxH.js";import"./utils-jAU0Cazi.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],D=X("CircleCheck",B),H=[{title:"Home",href:"/dashboard"},{title:"Play",href:"#"},{title:"1v1 Matchmaking",href:"/play/matchmaking"}],J=[{value:"python",label:"Python"},{value:"java",label:"Java"}],U=[{value:"easy",label:"Easy",hint:"Warm-up tasks"},{value:"medium",label:"Medium",hint:"Trickier logic"},{value:"hard",label:"Hard",hint:"Deep problem-solving"}],le=()=>{var v;const{props:o}=L(),c=(v=o==null?void 0:o.auth)==null?void 0:v.user,[i,S]=r.useState("python"),[l,M]=r.useState("easy"),[d,g]=r.useState(!1),[E,x]=r.useState(1),[f,m]=r.useState(null),[j,N]=r.useState(null),u=r.useMemo(()=>`presence-queue.${i}.${l}`,[i,l]),h=(a,s)=>{const n=s?`/play/m/${a}?t=${encodeURIComponent(s)}`:`/play/m/${a}`;window.location.href=n};async function p(a,s){const n=s?await b.post(a,s):await b.post(a);return n&&typeof n=="object"&&"data"in n?n.data:n}r.useEffect(()=>{if(!d)return;const a=window.Echo;if(a)return a.join(u).here(s=>x(s.length)).joining(()=>x(s=>s+1)).leaving(()=>x(s=>Math.max(1,s-1))).listen("MatchFound",async()=>{try{const s=await p("/api/matchmaking/poll",{language:i,difficulty:l});"slug"in s&&s.slug&&h(s.slug,s.token)}catch{}}),a.private(`user.${c.id}`).listen("MatchFound",async()=>{try{const s=await p("/api/matchmaking/poll",{language:i,difficulty:l});"slug"in s&&s.slug&&h(s.slug,s.token)}catch{}}),()=>{try{window.Echo.leave(u)}catch{}try{window.Echo.leave(`user.${c.id}`)}catch{}}},[d,u,c==null?void 0:c.id,i,l]);const T=async()=>{var a,s,n;N(null),g(!0),m(null);try{const t=await p("/api/matchmaking/join",{language:i,difficulty:l,resume:!1});if("slug"in t&&t.slug){h(t.slug,t.token);return}"queued"in t&&t.queued||"paired"in t&&t.paired?m(String(c.id)):"ticket_id"in t&&t.ticket_id&&m(String(t.ticket_id))}catch(t){console.error("[JOIN ERROR]",((a=t==null?void 0:t.response)==null?void 0:a.data)||t),N(((n=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to join matchmaking."),g(!1)}};r.useEffect(()=>{if(!d)return;let a=!1;const s=async()=>{try{const t=await p("/api/matchmaking/poll",{language:i,difficulty:l});if(!a&&"slug"in t&&t.slug){h(t.slug,t.token);return}}catch{}a||setTimeout(s,1200)},n=setTimeout(s,800);return()=>{a=!0,clearTimeout(n)}},[d,i,l]);const A=async()=>{var a;N(null);try{await b.post("/api/matchmaking/cancel")}catch{}finally{g(!1),m(null),x(1);try{(a=window.Echo)==null||a.leave(u)}catch{}}};return e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-0 -z-10",children:e.jsx(F,{})}),e.jsxs($,{breadcrumbs:H,children:[e.jsx(I,{title:"1v1 Matchmaking"}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{className:"w-7 h-7 text-indigo-400"}),e.jsx(z,{className:"w-5 h-5 text-cyan-400"}),e.jsx(k,{className:"w-6 h-6 text-emerald-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-400 via-fuchsia-400 to-cyan-400 bg-clip-text text-transparent",children:"1V1 MATCHMAKING"}),e.jsx("p",{className:"text-zinc-400 text-sm",children:"Queue by language & difficulty and get paired instantly."})]})]})}),e.jsxs("div",{className:"rounded-2xl border border-slate-700/60 bg-slate-900/40 shadow-xl",children:[e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"text-sm text-zinc-400",children:"Language"}),e.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:J.map(a=>{const s=i===a.value;return e.jsxs("button",{onClick:()=>S(a.value),disabled:d,className:["flex items-center justify-center gap-2 px-4 py-3 rounded-xl border transition",s?"border-indigo-500/60 bg-indigo-500/10":"border-slate-700/60 hover:border-slate-600"].join(" "),"aria-pressed":s,children:[e.jsx(z,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:a.label})]},a.value)})})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"text-sm text-zinc-400",children:"Difficulty"}),e.jsx("div",{className:"mt-2 grid grid-cols-3 gap-2",children:U.map(a=>{const s=l===a.value;return e.jsx("button",{onClick:()=>M(a.value),disabled:d,className:["px-3 py-3 rounded-xl border text-sm transition",s?"border-emerald-500/60 bg-emerald-500/10":"border-slate-700/60 hover:border-slate-600"].join(" "),"aria-pressed":s,title:a.hint,children:a.label},a.value)})})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsxs("label",{className:"text-sm text-zinc-400 flex items-center gap-2",children:["Mode",e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-zinc-500",children:[e.jsx(P,{className:"w-3 h-3"})," Token-safe"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"w-full px-4 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"AI-Generated"})]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-slate-800 text-zinc-400",children:"Same prompt for both"})]}),e.jsx("p",{className:"mt-2 text-xs text-zinc-500",children:"A single challenge is generated & frozen server-side so both players get the exact same text & tests."})]})]})]}),e.jsx("div",{className:"border-t border-slate-700/60"}),e.jsxs("div",{className:"p-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsx(Q,{className:"w-4 h-4 text-zinc-400"}),e.jsxs("span",{className:"text-zinc-400",children:["Players waiting in ",e.jsx("span",{className:"font-medium text-zinc-200",children:i})," /",e.jsxs("span",{className:"font-medium text-zinc-200",children:[" ",l]}),":"]}),e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-lg bg-slate-800 text-zinc-100",children:E})]}),e.jsx("div",{className:"flex items-center gap-3",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl border border-slate-700/60 bg-slate-900/40 text-zinc-200",children:[e.jsx(R,{className:"w-4 h-4 animate-spin"}),"Searching…"]}),e.jsxs("button",{onClick:A,className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl bg-slate-800 hover:bg-slate-700 transition text-zinc-200",children:[e.jsx(C,{className:"w-4 h-4"}),"Cancel"]})]}):e.jsxs("button",{onClick:T,className:"inline-flex items-center gap-2 px-4 py-3 rounded-xl bg-gradient-to-r from-cyan-500 to-indigo-600 hover:opacity-95 active:opacity-100 transition text-white font-medium",children:[e.jsx(w,{className:"w-4 h-4"}),"Find Match"]})})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(y,{icon:e.jsx(q,{className:"w-4 h-4"}),title:"Speed wins",text:"Winner is the first to submit a correct solution. Ties decided by time to correct."}),e.jsx(y,{icon:e.jsx(_,{className:"w-4 h-4"}),title:"No code mirroring",text:"You only see your own editor. Opponent panel shows status/animations only."}),e.jsx(y,{icon:e.jsx(O,{className:"w-4 h-4"}),title:"XP rules",text:"Base XP by difficulty; minus 0.5 if you used a hint (server-enforced)."})]}),(j||f)&&e.jsxs("div",{className:"mt-6 flex flex-col gap-2",children:[j&&e.jsxs("div",{className:"flex items-center gap-2 text-red-300 bg-red-900/20 border border-red-900/40 px-3 py-2 rounded-lg",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:j})]}),f&&e.jsxs("div",{className:"flex items-center gap-2 text-emerald-300 bg-emerald-900/20 border border-emerald-900/40 px-3 py-2 rounded-lg",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:["Queued (ticket #",f,"). You’ll auto-join when a match is found."]})]})]})]})]})]})},y=({icon:o,title:c,text:i})=>e.jsxs("div",{className:"rounded-xl border border-slate-700/60 bg-slate-900/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-zinc-300",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-lg bg-slate-800",children:o}),e.jsx("span",{className:"text-sm font-medium",children:c})]}),e.jsx("p",{className:"mt-2 text-xs text-zinc-500",children:i})]});export{le as default};
