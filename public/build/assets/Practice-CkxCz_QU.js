import{K as ie,r,j as e,L as M}from"./app-CJqyWFNM.js";import{A as z,b as oe}from"./app-layout-Ci-BKSnf.js";import{S as ce}from"./sweetalert2.esm.all-acGi8jXx.js";import{A as de}from"./AnimatedBackground-KhkQeE9a.js";import{R as me}from"./refresh-cw-CX-_fts0.js";import{B as xe,X as ue}from"./x-Bipg_Ls7.js";import{C as B}from"./users-Bsu8iH3l.js";import{L as J}from"./lightbulb-CYnkUZwj.js";import{F as he}from"./filter-CG2DtXto.js";import{S as ge}from"./search-nDYSb-Ri.js";import{C as fe}from"./chart-column-BfMaAO1M.js";import{E as pe}from"./eye-off-C9QC99ix.js";import{E as be}from"./eye-BaKwWVaD.js";import{C as je}from"./circle-check-big-9HEcsnz3.js";import{A as ye}from"./arrow-left-BVzQ-WV1.js";import{A as we}from"./arrow-right-DN_FmvAz.js";import"./utils-jAU0Cazi.js";import"./createLucideIcon-B_cuIBFx.js";const K=[{title:"Home",href:"/dashboard"},{title:"Practice",href:"#"},{title:"Review Mode",href:"/play/practice"}];function ze(){var O,$;const{auth:A}=ie().props;A==null||A.user;const[f,q]=r.useState([]),[p,X]=r.useState([]),[b,j]=r.useState(0),[I,T]=r.useState(null),[d,_]=r.useState(!1),[v,E]=r.useState(!1),[S,H]=r.useState("python"),[m,W]=r.useState("all"),[L,V]=r.useState(""),[Y,F]=r.useState(!0),[D,G]=r.useState([]),[x,R]=r.useState(new Set),[u,U]=r.useState(0),y=r.useRef(null),w=r.useRef(null),Q=((O=document.querySelector('meta[name="csrf-token"]'))==null?void 0:O.content)||(($=window.Laravel)==null?void 0:$.csrfToken)||"",[Z,Ne]=r.useState(!0);r.useRef(null);const h=s=>{if(Z)try{oe.play(s)}catch{}};r.useEffect(()=>{P()},[S]),r.useEffect(()=>{ee()},[f,m,L,x]),r.useEffect(()=>{w.current&&u>0&&x.size>=u&&fetch("/practice/finish",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":Q},body:JSON.stringify({question_set_id:w.current.id})}).finally(()=>{P()})},[x,u]);const P=async()=>{const s=new AbortController;try{F(!0);const t=await fetch(`/practice/current?language=${S}`,{signal:s.signal,credentials:"same-origin"});if(!t.ok)throw new Error("Failed to fetch current set");const n=await t.json(),{set:i,progress:l}=n;w.current={id:i.id,filename:i.filename,total_questions:i.total_questions},U(i.total_questions||0),y.current=(l==null?void 0:l.last_question_id)??null;const k=await fetch(`/data/${i.filename}`,{signal:s.signal,credentials:"same-origin"});if(!k.ok)throw new Error(`Failed to load ${i.filename}`);const N=await k.json();q(N),G([...new Set(N.map(c=>c.category))]);const o=Array.isArray(l==null?void 0:l.taken_ids)?l.taken_ids:[];R(new Set(o)),C()}catch(t){(t==null?void 0:t.name)!=="AbortError"&&(console.error("Error loading questions:",t),q([]),ce.fire({icon:"error",title:"Loading Error",text:"Failed to load questions or set metadata. Make sure the routes and JSON files exist."}))}finally{F(!1)}return()=>s.abort()},ee=()=>{const s=L.trim().toLowerCase();let t=f.filter(n=>!x.has(n.id));if(m!=="all"&&(t=t.filter(n=>n.category===m)),s&&(t=t.filter(n=>n.question.toLowerCase().includes(s)||n.category.toLowerCase().includes(s))),X(t),t.length===0){j(0);return}if(y.current!=null){const n=y.current;let i=null;const l={};f.forEach((o,c)=>l[o.id]=c);const k=l[n]??-1;for(let o=k+1;o<f.length;o++){const c=f[o],le=m==="all"||c.category===m,ne=!s||c.question.toLowerCase().includes(s)||c.category.toLowerCase().includes(s);if(!x.has(c.id)&&le&&ne){i=c.id;break}}i==null&&(i=t[0].id);const N=t.findIndex(o=>o.id===i);j(N>=0?N:0),y.current=null}else j(n=>Math.min(n,Math.max(0,t.length-1)))},C=()=>{T(null),_(!1),E(!1)},a=p[b],g=d&&I===(a==null?void 0:a.answer),se=async()=>{if(a&&w.current){R(s=>{const t=new Set(s);return t.add(a.id),t});try{await fetch("/practice/taken",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":Q},body:JSON.stringify({question_set_id:w.current.id,question_id:a.id})}),y.current=a.id}catch(s){console.error("Failed to mark taken",s)}}C()},te=()=>{b>0&&(j(s=>s-1),C())},re=()=>E(s=>!s),ae=s=>{d||!a||(h("click"),T(s),_(!0),E(!0),s===a.answer?h("success"):h("failure"))};return Y?e.jsxs(z,{breadcrumbs:K,children:[e.jsx(M,{title:"Practice Review"}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(me,{className:"h-8 w-8 animate-spin mx-auto mb-2 text-blue-400"}),e.jsx("div",{className:"text-gray-300",children:"Loading questions..."})]})})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[e.jsx(de,{}),e.jsxs(z,{breadcrumbs:K,children:[e.jsx(M,{title:"Practice Review"}),e.jsxs("div",{className:"flex flex-col gap-6 p-4 relative z-10",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(xe,{className:"h-8 w-8 text-blue-400"}),e.jsx(B,{className:"h-6 w-6 text-purple-400"}),e.jsx(J,{className:"h-8 w-8 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"PRACTICE REVIEWywfbg"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Review programming questions and learn from explanations"})]})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"lg:w-1/3 flex flex-col gap-6",children:[e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(he,{className:"h-5 w-5 text-purple-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Question Filters"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Language"}),e.jsxs("select",{value:S,onChange:s=>H(s.target.value),className:"w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200",children:[e.jsx("option",{value:"python",children:"Python"}),e.jsx("option",{value:"java",children:"Java"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Category"}),e.jsxs("select",{value:m,onChange:s=>W(s.target.value),className:"w-full px-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200",children:[e.jsx("option",{value:"all",children:"All Categories"}),D.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search...",value:L,onChange:s=>V(s.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-900/50 border border-gray-600 rounded-lg text-gray-200 placeholder-gray-400"})]})]})]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(fe,{className:"h-5 w-5 text-green-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Session Stats"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Total Questions:"}),e.jsx("span",{className:"text-blue-300 font-medium",children:u})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Current Progress:"}),e.jsxs("span",{className:"text-purple-300 font-medium",children:[x.size,"/",u]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Language:"}),e.jsx("span",{className:"text-green-300 font-medium capitalize",children:S})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Category:"}),e.jsx("span",{className:"text-yellow-300 font-medium",children:m==="all"?"All":m})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[e.jsx("span",{children:"Completion"}),e.jsxs("span",{children:[p.length>0?Math.round((b+1)/p.length*100):0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${u>0?Math.round(x.size/u*100):0}%`}})})]})]})]}),e.jsx("div",{className:"lg:w-2/3",children:p.length===0?e.jsxs("div",{className:"bg-gray-800/50 rounded-xl p-12 text-center",children:[e.jsx(B,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl text-gray-300 mb-2",children:"No Questions Found"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"You may have completed all questions for this set/filter."}),e.jsx("button",{onClick:()=>{R(new Set),j(0),C()},className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:"Revisit Questions in This Set"})]}):a&&e.jsxs("div",{className:"bg-gray-900/60 rounded-xl shadow-lg overflow-hidden border border-gray-700",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 flex items-center justify-between",children:[e.jsx("div",{className:"bg-white/20 px-3 py-1 rounded-full text-white text-sm font-medium shadow-md",children:a.category}),e.jsxs("button",{onClick:()=>{re(),h("hover")},className:"flex items-center space-x-2 px-4 py-2 bg-white/10 hover:bg-white/20 text-white font-medium rounded-lg shadow transition",children:[v?e.jsx(pe,{className:"h-4 w-4"}):e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{children:v?"Hide Answer":"Show Answer"})]})]}),e.jsxs("div",{className:"p-8",children:[e.jsx("div",{className:"mb-6 p-4 bg-gray-800/40 border border-gray-700 rounded-lg",children:e.jsx("p",{className:"text-xl text-white font-semibold leading-relaxed whitespace-pre-line",children:a.question.split(/(`[^`]+`)/g).map((s,t)=>s.startsWith("`")?e.jsx("code",{className:"bg-gray-700 px-2 py-1 rounded text-purple-300 font-mono text-base",children:s.replace(/`/g,"")},t):s)})}),d&&e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold ${g?"bg-green-900/40 text-green-200":"bg-rose-900/40 text-rose-200"}`,children:[g?e.jsx(je,{className:"h-4 w-4"}):e.jsx(ue,{className:"h-4 w-4"}),g?"Correct":"Incorrect"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-6",children:a.choices.map((s,t)=>{const n=s===a.answer,i=s===I;let l="p-4 rounded-lg border cursor-pointer transition-all ";return v?n?l+="bg-green-900/50 border-green-400 text-green-100":d&&i&&!n?l+="bg-rose-900/50 border-rose-400 text-rose-100":l+="bg-gray-900/20 border-gray-700 text-gray-400":l+="bg-gray-900/30 border-gray-600 text-gray-300 hover:border-gray-400",e.jsx("div",{className:l,onClick:()=>ae(s),onMouseEnter:()=>h("hover"),children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-full border flex items-center justify-center",children:String.fromCharCode(65+t)}),e.jsx("span",{className:"font-mono",children:s})]})},t)})})]}),v&&e.jsxs("div",{className:`mx-8 mb-6 rounded-lg p-6 border ${d?g?"bg-green-900/20 border-green-500/30":"bg-rose-900/20 border-rose-500/30":"bg-blue-900/20 border-blue-500/30"}`,children:[e.jsxs("h4",{className:`font-bold mb-2 flex items-center ${d&&!g?"text-rose-300":"text-green-400"}`,children:[e.jsx(J,{className:"h-5 w-5 mr-2"})," Explanation"]}),e.jsx("p",{className:`${d&&!g?"text-rose-100":"text-green-200"}`,children:d?g?a.explanation_correct:a.explanation_wrong:a.explanation_correct})]}),e.jsxs("div",{className:"bg-gray-900/30 px-8 py-4 flex justify-between",children:[e.jsxs("button",{onClick:()=>{te(),h("click")},disabled:b===0,className:"px-4 py-2 bg-gray-700 text-gray-300 rounded-lg disabled:opacity-50",children:[e.jsx(ye,{className:"h-4 w-4 inline"})," Previous"]}),e.jsxs("div",{className:"text-gray-400 text-sm",children:["Answered ",x.size," / ",u]}),e.jsxs("button",{onClick:()=>{se(),h("click")},disabled:b===p.length-1,className:"px-4 py-2 bg-blue-600 text-white rounded-lg disabled:opacity-50",children:["Next ",e.jsx(we,{className:"h-4 w-4 inline"})]})]})]})})]})]})]})]})}export{ze as default};
